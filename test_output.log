============================= test session starts ==============================
platform linux -- Python 3.10.18, pytest-8.4.2, pluggy-1.6.0 -- /home/ollie/miniconda3/envs/pytorch/bin/python3.10
cachedir: .pytest_cache
rootdir: /home/ollie/Documents/nanoBragg
configfile: pyproject.toml
plugins: typeguard-2.13.3, anyio-4.9.0
collecting ... collected 524 items / 1 skipped

tests/test_at_abs_001.py::TestAT_ABS_001::test_absorption_disabled_when_zero PASSED [  0%]
tests/test_at_abs_001.py::TestAT_ABS_001::test_capture_fraction_calculation PASSED [  0%]
tests/test_at_abs_001.py::TestAT_ABS_001::test_last_value_vs_accumulation_semantics PASSED [  0%]
tests/test_at_abs_001.py::TestAT_ABS_001::test_parallax_dependence PASSED [  0%]
tests/test_at_abs_001.py::TestAT_ABS_001::test_absorption_with_tilted_detector PASSED [  0%]
tests/test_at_bkg_001.py::TestAT_BKG_001::test_water_background_calculation PASSED [  1%]
tests/test_at_bkg_001.py::TestAT_BKG_001::test_water_background_zero PASSED [  1%]
tests/test_at_bkg_001.py::TestAT_BKG_001::test_water_background_additive PASSED [  1%]
tests/test_at_cli_001.py::TestAT_CLI_001::test_cli_help_short_flag PASSED [  1%]
tests/test_at_cli_001.py::TestAT_CLI_001::test_cli_help_long_flag PASSED [  1%]
tests/test_at_cli_001.py::TestAT_CLI_001::test_cli_invocable PASSED      [  2%]
tests/test_at_cli_001.py::TestAT_CLI_001::test_cli_help_includes_examples PASSED [  2%]
tests/test_at_cli_001.py::TestAT_CLI_001::test_cli_help_includes_wavelength_synonyms PASSED [  2%]
tests/test_at_cli_001.py::TestAT_CLI_001::test_cli_help_includes_output_synonyms PASSED [  2%]
tests/test_at_cli_002.py::TestAT_CLI_002::test_minimal_render_with_default_F PASSED [  2%]
tests/test_at_cli_002.py::TestAT_CLI_002::test_minimal_render_with_hkl_file PASSED [  3%]
tests/test_at_cli_002.py::TestAT_CLI_002::test_data_ordering_fast_major PASSED [  3%]
tests/test_at_cli_002.py::TestAT_CLI_002::test_error_without_required_inputs PASSED [  3%]
tests/test_at_cli_003.py::TestATCLI003::test_mosflm_default_pivot_beam PASSED [  3%]
tests/test_at_cli_003.py::TestATCLI003::test_xds_default_pivot_sample PASSED [  3%]
tests/test_at_cli_003.py::TestATCLI003::test_pivot_override_mosflm_to_sample PASSED [  4%]
tests/test_at_cli_003.py::TestATCLI003::test_pivot_override_xds_to_beam PASSED [  4%]
tests/test_at_cli_003.py::TestATCLI003::test_convention_header_keys_consistency PASSED [  4%]
tests/test_at_cli_004.py::test_header_precedence_img_then_mask PASSED    [  4%]
tests/test_at_cli_004.py::test_mask_zeros_are_skipped PASSED             [  4%]
tests/test_at_cli_004.py::test_mask_beam_center_y_flip PASSED            [  4%]
tests/test_at_cli_004.py::test_conflicting_detector_size PASSED          [  5%]
tests/test_at_cli_004.py::test_img_only_no_mask PASSED                   [  5%]
tests/test_at_cli_005.py::test_cli_roi_basic PASSED                      [  5%]
tests/test_at_cli_005.py::test_cli_roi_with_noise PASSED                 [  5%]
tests/test_at_cli_005.py::test_cli_roi_edge_cases PASSED                 [  5%]
tests/test_at_cli_005.py::test_cli_roi_different_conventions PASSED      [  6%]
tests/test_at_cli_006.py::test_autoscale_without_scale_flag PASSED       [  6%]
tests/test_at_cli_006.py::test_explicit_scale_flag PASSED                [  6%]
tests/test_at_cli_006.py::test_pgm_without_pgmscale PASSED               [  6%]
tests/test_at_cli_006.py::test_pgm_with_explicit_pgmscale PASSED         [  6%]
tests/test_at_cli_006.py::test_pgm_format_compliance PASSED              [  7%]
tests/test_at_cli_007.py::TestATCLI007NoiseDeterminism::test_identical_seed_produces_identical_noise PASSED [  7%]
tests/test_at_cli_007.py::TestATCLI007NoiseDeterminism::test_different_seed_produces_different_noise PASSED [  7%]
tests/test_at_cli_007.py::TestATCLI007NoiseDeterminism::test_seed_determinism_without_roi PASSED [  7%]
tests/test_at_cli_007.py::TestATCLI007NoiseDeterminism::test_negative_seed_accepted PASSED [  7%]
tests/test_at_cli_007.py::TestATCLI007NoiseDeterminism::test_overload_count_determinism PASSED [  8%]
tests/test_at_cli_008.py::TestATCLI008DminFiltering::test_dmin_filtering_reduces_intensity PASSED [  8%]
tests/test_at_cli_008.py::TestATCLI008DminFiltering::test_dmin_very_strict_removes_most_intensity PASSED [  8%]
tests/test_at_cli_008.py::TestATCLI008DminFiltering::test_dmin_zero_has_no_effect PASSED [  8%]
tests/test_at_cli_009.py::TestATCLI009ErrorHandling::test_missing_hkl_and_fdump_with_default_f_zero PASSED [  8%]
tests/test_at_cli_009.py::TestATCLI009ErrorHandling::test_missing_hkl_but_has_default_f PASSED [  8%]
tests/test_at_cli_009.py::TestATCLI009ErrorHandling::test_missing_cell_parameters PASSED [  9%]
tests/test_at_cli_009.py::TestATCLI009ErrorHandling::test_fdump_fallback PASSED [  9%]
tests/test_at_cli_009.py::TestATCLI009ErrorHandling::test_help_message PASSED [  9%]
tests/test_at_cli_009.py::TestATCLI009ErrorHandling::test_unsupported_flag_dispstep PASSED [  9%]
tests/test_at_cli_009.py::TestATCLI009ErrorHandling::test_unsupported_flag_hdiv PASSED [  9%]
tests/test_at_cli_009.py::TestATCLI009ErrorHandling::test_unsupported_flag_vdiv PASSED [ 10%]
tests/test_at_crystal_absolute.py::TestATCrystalAbsolute::test_triclinic_absolute_positions PASSED [ 10%]
tests/test_at_crystal_absolute.py::TestATCrystalAbsolute::test_cubic_vs_triclinic_systematic_difference PASSED [ 10%]
tests/test_at_crystal_absolute.py::TestATCrystalAbsolute::test_known_reflection_d_spacings PASSED [ 10%]
tests/test_at_flu_001.py::TestAT_FLU_001::test_fluence_calculation_from_flux_exposure_beamsize PASSED [ 10%]
tests/test_at_flu_001.py::TestAT_FLU_001::test_no_fluence_calculation_when_flux_zero PASSED [ 11%]
tests/test_at_flu_001.py::TestAT_FLU_001::test_no_fluence_calculation_when_exposure_zero PASSED [ 11%]
tests/test_at_flu_001.py::TestAT_FLU_001::test_fluence_calculation_with_beamsize_zero PASSED [ 11%]
tests/test_at_flu_001.py::TestAT_FLU_001::test_flux_recomputation_from_fluence_and_exposure PASSED [ 11%]
tests/test_at_flu_001.py::TestAT_FLU_001::test_sample_clipping_warning PASSED [ 11%]
tests/test_at_flu_001.py::TestAT_FLU_001::test_no_clipping_when_beamsize_larger PASSED [ 12%]
tests/test_at_flu_001.py::TestAT_FLU_001::test_no_clipping_when_beamsize_zero PASSED [ 12%]
tests/test_at_geo_001.py::test_at_geo_001_mosflm_beam_center_mapping PASSED [ 12%]
tests/test_at_geo_002.py::test_at_geo_002_setup_a_distance_only PASSED   [ 12%]
tests/test_at_geo_002.py::test_at_geo_002_setup_b_close_distance_only PASSED [ 12%]
tests/test_at_geo_002.py::test_at_geo_002_setup_c_explicit_override PASSED [ 12%]
tests/test_at_geo_002.py::test_at_geo_002_setup_c_beam_override PASSED   [ 13%]
tests/test_at_geo_002.py::test_at_geo_002_direct_instantiation PASSED    [ 13%]
tests/test_at_geo_003.py::TestATGEO003RFactorAndBeamCenter::test_r_factor_calculation PASSED [ 13%]
tests/test_at_geo_003.py::TestATGEO003RFactorAndBeamCenter::test_distance_update_with_close_distance PASSED [ 13%]
tests/test_at_geo_003.py::TestATGEO003RFactorAndBeamCenter::test_beam_center_preservation_beam_pivot PASSED [ 13%]
tests/test_at_geo_003.py::TestATGEO003RFactorAndBeamCenter::test_beam_center_preservation_sample_pivot PASSED [ 14%]
tests/test_at_geo_003.py::TestATGEO003RFactorAndBeamCenter::test_no_rotations_r_factor_equals_one PASSED [ 14%]
tests/test_at_geo_003.py::TestATGEO003RFactorAndBeamCenter::test_beam_center_with_various_rotations[DetectorPivot.BEAM] PASSED [ 14%]
tests/test_at_geo_003.py::TestATGEO003RFactorAndBeamCenter::test_beam_center_with_various_rotations[DetectorPivot.SAMPLE] PASSED [ 14%]
tests/test_at_geo_003.py::TestATGEO003RFactorAndBeamCenter::test_gradients_flow_through_r_factor PASSED [ 14%]
tests/test_at_geo_004.py::test_twotheta_axis_defaults PASSED             [ 15%]
tests/test_at_geo_004.py::test_twotheta_axis_override PASSED             [ 15%]
tests/test_at_geo_004.py::test_twotheta_rotation_applied PASSED          [ 15%]
tests/test_at_geo_004.py::test_twotheta_value_preserved PASSED           [ 15%]
tests/test_at_geo_004.py::test_mosflm_twotheta_rotation PASSED           [ 15%]
tests/test_at_geo_004.py::test_dials_twotheta_rotation PASSED            [ 16%]
tests/test_at_geo_005.py::TestATGEO005CurvedDetector::test_curved_detector_equal_distance PASSED [ 16%]
tests/test_at_geo_005.py::TestATGEO005CurvedDetector::test_curved_vs_planar_difference PASSED [ 16%]
tests/test_at_geo_005.py::TestATGEO005CurvedDetector::test_small_angle_rotation_consistency PASSED [ 16%]
tests/test_at_geo_005.py::TestATGEO005CurvedDetector::test_gradient_flow_curved_detector PASSED [ 16%]
tests/test_at_geo_005.py::TestATGEO005CurvedDetector::test_beam_center_affects_curvature PASSED [ 16%]
tests/test_at_geo_006.py::TestATGEO006PointPixelSolidAngle::test_point_pixel_solid_angle PASSED [ 17%]
tests/test_at_geo_006.py::TestATGEO006PointPixelSolidAngle::test_default_solid_angle_with_obliquity PASSED [ 17%]
tests/test_at_geo_006.py::TestATGEO006PointPixelSolidAngle::test_off_center_pixel_comparison PASSED [ 17%]
tests/test_at_geo_006.py::TestATGEO006PointPixelSolidAngle::test_gradient_flow PASSED [ 17%]
tests/test_at_geo_006.py::TestATGEO006PointPixelSolidAngle::test_corner_pixel_values PASSED [ 17%]
tests/test_at_io_001.py::TestAT_IO_001::test_smv_header_required_keys PASSED [ 18%]
tests/test_at_io_001.py::TestAT_IO_001::test_smv_data_ordering PASSED    [ 18%]
tests/test_at_io_001.py::TestAT_IO_001::test_smv_convention_specific_headers PASSED [ 18%]
tests/test_at_io_001.py::TestAT_IO_001::test_smv_torch_tensor_input PASSED [ 18%]
tests/test_at_io_001.py::TestAT_IO_001::test_smv_byte_order PASSED       [ 18%]
tests/test_at_io_002.py::TestAT_IO_002::test_pgm_header_format PASSED    [ 19%]
tests/test_at_io_002.py::TestAT_IO_002::test_pgm_pixel_scaling PASSED    [ 19%]
tests/test_at_io_002.py::TestAT_IO_002::test_pgm_with_default_scale PASSED [ 19%]
tests/test_at_io_002.py::TestAT_IO_002::test_pgm_torch_tensor_input PASSED [ 19%]
tests/test_at_io_002.py::TestAT_IO_002::test_pgm_clipping_behavior PASSED [ 19%]
tests/test_at_io_003.py::TestAT_IO_003::test_fdump_write_and_read PASSED [ 20%]
tests/test_at_io_003.py::TestAT_IO_003::test_fdump_cache_behavior PASSED [ 20%]
tests/test_at_io_003.py::TestAT_IO_003::test_fdump_no_files_with_default_F PASSED [ 20%]
tests/test_at_io_003.py::TestAT_IO_003::test_fdump_no_files_zero_default PASSED [ 20%]
tests/test_at_io_003.py::TestAT_IO_003::test_fdump_preserves_default_F PASSED [ 20%]
tests/test_at_io_003.py::TestAT_IO_003::test_fdump_header_structure PASSED [ 20%]
tests/test_at_io_004.py::TestAT_IO_004::test_minimal_hkl_format PASSED   [ 21%]
tests/test_at_io_004.py::TestAT_IO_004::test_five_column_with_phase PASSED [ 21%]
tests/test_at_io_004.py::TestAT_IO_004::test_six_column_with_sigma_and_phase PASSED [ 21%]
tests/test_at_io_004.py::TestAT_IO_004::test_negative_indices_handling PASSED [ 21%]
tests/test_at_io_004.py::TestAT_IO_004::test_all_formats_produce_same_pattern 