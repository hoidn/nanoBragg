## 2025-09-30
- Reviewed current repo state; no prior galph memory.
- Identified critical outstanding parity failures (AT-020/021/022/024). AT-021 phi rotation bug is root cause for AT-022.
- Per long-term goals, PyTorch still shows major parity gaps plus performance overhead (torch.compile warm-up dominates small detectors; large crystal case still ~7× slower vs C). Potential optimizations: share compiled kernels across instances, real geometry caching, consider chunked evaluation to trim memory.
- Created supervisor plan for AT-021 debugging at `plans/active/at-parallel-021/plan.md`; cross-referenced from fix_plan. This plan should be the next loop (requires prompts/debug.md).
- Observed Ralph’s recent loops mainly documentation/perf; no regressions but backlog untouched. Next action for Ralph: run debug loop against AT-021 using new plan.

## 2025-09-30 (galph loop 2)
- Deep dive confirmed AT-PARALLEL-024 failure stems from the random misset cap mismatch: PyTorch clamps to π/2 (`src/nanobrag_torch/models/crystal.py:594-603`) while C uses the raw `90.0` argument as radians (`golden_suite_generator/nanoBragg.c:2010-2016`). Documented evidence in fix_plan and opened dedicated plan at `plans/active/at-parallel-024/plan.md` with phased instructions.
- Verified AT-PARALLEL-021/022 parity now pass after commit 8293a15; updated `docs/fix_plan.md` to mark both complete and to record new metrics + unit-test alignment (`tests/test_suite.py:167-207`). Plan 021 can be archived once Ralph confirms AT-022 stays green in his next loop.
- Performance review: benchmarks (`reports/benchmarks/20250930-111451/benchmark_results.json`) still show PyTorch ≥10× slower than C for ≤1k detectors; primary culprits are per-instance `torch.compile` wrapping in `Simulator.__init__` and repeated constant tensor creation inside `_compute_physics_for_position`. Flag for future perf initiative.
- Ralph review: last seven loops (`RALPH-ROUTING-001`…`RALPH-VERIFICATION-007`) repeatedly re-ran the full suite without debugging, even mislabeling the phi fix as a regression (`d702171`). Next guidance: insist Ralph route through `prompts/debug.md` for outstanding ATs and avoid further verification-only loops.
- VC hygiene: committed plan+fix_plan update (`SUPERVISOR: at-parallel-024 parity plan - tests: parity AT-021/022`). Worktree remains dirty from pre-existing artifacts (e.g., `tests/test_suite.py`, `parallel_test_visuals/*`, `trash/test_parity_matrix.py`); do not stage these on the next loop without user direction.
- Next steps for Ralph: execute the new AT-024 plan under `prompts/debug.md`, reproduce misset angles against C, and implement the 90-radian cap fix.

## 2025-09-30 (galph loop 3)
- Deep analysis: `_compute_physics_for_position` is still wrapped by `torch.compile` inside every `Simulator` ctor (per-run warm-up 0.5–6s). Constants like `torch.tensor(1e-12, device=...)` are created inside the compiled path, forcing Dynamo to materialize tensors each call; recommend caching via `.new_tensor()` or lifting constants alongside a shared compiled kernel. Random misset fix in commit ac29c4f now mirrors C's 90-radian bug—parity restored but we still need a follow-up story before calling the PyTorch port “better than C”.
- Ralph review (last ~20 commits): positives — ac29c4f fixed AT-024 parity, d9d0a06 finally gathered first divergence for AT-012; negatives — repeated routing violations and contradictory fix_plan statuses caused the triclinic work to stall. Commit 92ac528 accidentally dragged the entire `golden_suite_generator/nanoBragg.c` binary diff; watch for unnecessary churn in future loops.
- Planning: opened `plans/active/at-parallel-012/plan.md` to drive the rotation-matrix investigation (Phase A–E). Updated `docs/fix_plan.md` to mark AT-012 as active, supersede the “precision-only” conclusion, and point Ralph at the new plan.
- Next Ralph steps: run prompts/debug.md, execute Phase A of the AT-012 plan (dump C vs PyTorch rotation matrices), then march through the plan. Avoid verification loops until AT-012 closes; flag any binary churn (like re-adding full C sources) before committing.
