cases:
  - id: AT-PARALLEL-001
    description: Beam center scaling parity (C ↔ PyTorch)
    base_args: >-
      -default_F 100
      -cell 100 100 100 90 90 90
      -lambda 6.2
      -N 3
      -pixel 0.1
      -distance 100
      -mosflm
      -seed 1
    thresholds:
      corr_min: 0.9999
      sum_ratio_min: 0.9
      sum_ratio_max: 1.1
      max_abs_max: 500
    runs:
      - name: detpixels-64
        extra_args: >-
          -detpixels 64
          -Xbeam 3.2
          -Ybeam 3.2
      - name: detpixels-128
        extra_args: >-
          -detpixels 128
          -Xbeam 6.4
          -Ybeam 6.4
      - name: detpixels-256
        extra_args: >-
          -detpixels 256
          -Xbeam 12.8
          -Ybeam 12.8
      - name: detpixels-512
        extra_args: >-
          -detpixels 512
          -Xbeam 25.6
          -Ybeam 25.6

  - id: AT-PARALLEL-002
    description: Pixel size independence parity (C ↔ PyTorch)
    base_args: >-
      -default_F 100
      -cell 100 100 100 90 90 90
      -lambda 6.2
      -N 5
      -distance 100
      -seed 1
      -detpixels 256
    thresholds:
      corr_min: 0.9999
      sum_ratio_min: 0.9
      sum_ratio_max: 1.1
      max_abs_max: 300
    runs:
      - name: pixel-0.05mm
        extra_args: >-
          -pixel 0.05
          -Xbeam 25.6
          -Ybeam 25.6
          -mosflm
      - name: pixel-0.1mm
        extra_args: >-
          -pixel 0.1
          -Xbeam 25.6
          -Ybeam 25.6
          -mosflm
      - name: pixel-0.2mm
        extra_args: >-
          -pixel 0.2
          -Xbeam 25.6
          -Ybeam 25.6
          -mosflm
      - name: pixel-0.4mm
        extra_args: >-
          -pixel 0.4
          -Xbeam 25.6
          -Ybeam 25.6
          -mosflm

  - id: AT-PARALLEL-003
    description: Detector offset preservation parity (C ↔ PyTorch)
    base_args: >-
      -default_F 100
      -cell 100 100 100 90 90 90
      -lambda 6.2
      -N 5
      -distance 100
      -pixel 0.1
      -mosflm
      -seed 1
    thresholds:
      corr_min: 0.9999
      sum_ratio_min: 0.98
      sum_ratio_max: 1.02
      max_abs_max: 500
    runs:
      - name: beam-20-20-detpixels-256
        extra_args: >-
          -detpixels 256
          -Xbeam 20.0
          -Ybeam 20.0
      - name: beam-30-40-detpixels-256
        extra_args: >-
          -detpixels 256
          -Xbeam 30.0
          -Ybeam 40.0
      - name: beam-45-25-detpixels-512
        extra_args: >-
          -detpixels 512
          -Xbeam 45.0
          -Ybeam 25.0
      - name: beam-60-60-detpixels-1024
        extra_args: >-
          -detpixels 1024
          -Xbeam 60.0
          -Ybeam 60.0

  - id: AT-PARALLEL-004
    description: MOSFLM vs XDS convention parity (C ↔ PyTorch)
    base_args: >-
      -default_F 100
      -cell 100 100 100 90 90 90
      -lambda 1.0
      -N 5
      -detpixels 256
      -distance 100
      -pixel 0.1
      -seed 1
    thresholds:
      corr_min: 0.9999
      sum_ratio_min: 0.9
      sum_ratio_max: 1.1
      max_abs_max: 500
    runs:
      - name: mosflm
        extra_args: >-
          -mosflm
          -Xbeam 25.6
          -Ybeam 25.6
      - name: xds
        extra_args: >-
          -xds
          -Xbeam 25.6
          -Ybeam 25.6

  - id: AT-PARALLEL-005
    description: Beam center parameter mapping parity (C ↔ PyTorch)
    base_args: >-
      -default_F 100
      -cell 100 100 100 90 90 90
      -lambda 1.0
      -N 5
      -detpixels 256
      -pixel 0.1
      -seed 1
    thresholds:
      corr_min: 0.9999
      sum_ratio_min: 0.98
      sum_ratio_max: 1.02
      max_abs_max: 500
    runs:
      - name: mosflm-xbeam-ybeam-beam-pivot
        extra_args: >-
          -mosflm
          -distance 100
          -Xbeam 25.6
          -Ybeam 25.6
      - name: xds-xbeam-ybeam-sample-pivot
        extra_args: >-
          -xds
          -distance 100
          -Xbeam 25.6
          -Ybeam 25.6
      - name: mosflm-close-distance-sample-pivot
        extra_args: >-
          -mosflm
          -close_distance 100
          -Xbeam 25.6
          -Ybeam 25.6
      - name: xds-close-distance-sample-pivot
        extra_args: >-
          -xds
          -close_distance 100
          -Xbeam 25.6
          -Ybeam 25.6

  - id: AT-PARALLEL-006
    description: Single reflection position parity across distance/wavelength sweeps
    base_args: >-
      -default_F 100
      -cell 100 100 100 90 90 90
      -pixel 0.1
      -detpixels 256
      -mosflm
      -N 1
      -seed 1
    thresholds:
      corr_min: 0.9999
      sum_ratio_min: 0.9
      sum_ratio_max: 1.1
      max_abs_max: 250
    runs:
      - name: dist-50mm-lambda-1.0
        extra_args: >-
          -distance 50
          -lambda 1.0
      - name: dist-100mm-lambda-1.5
        extra_args: >-
          -distance 100
          -lambda 1.5
      - name: dist-200mm-lambda-2.0
        extra_args: >-
          -distance 200
          -lambda 2.0

  - id: AT-PARALLEL-007
    description: Peak position parity with detector rotations
    base_args: >-
      -default_F 100
      -cell 100 100 100 90 90 90
      -lambda 1.0
      -pixel 0.1
      -detpixels 256
      -distance 100
      -N 5
      -seed 1
    thresholds:
      corr_min: 0.9999
      sum_ratio_min: 0.9
      sum_ratio_max: 1.1
      max_abs_max: 400
    runs:
      - name: rot-0-0-0
        extra_args: >-
          -detector_rotx 0
          -detector_roty 0
          -detector_rotz 0
          -mosflm
      - name: rot-5-3-2
        extra_args: >-
          -detector_rotx 5
          -detector_roty 3
          -detector_rotz 2
          -mosflm
      - name: rot-10-5-3
        extra_args: >-
          -detector_rotx 10
          -detector_roty 5
          -detector_rotz 3
          -mosflm

  - id: AT-PARALLEL-012
    description: Reference pattern correlation (simple_cubic, triclinic, tilted)
    base_args: >-
      -default_F 100
      -cell 100 100 100 90 90 90
      -lambda 6.2
      -N 5
      -distance 100
      -pixel 0.1
      -seed 1
      -mosflm
    thresholds:
      corr_min: 0.9995
      sum_ratio_min: 0.9
      sum_ratio_max: 1.1
      max_abs_max: 500
    runs:
      - name: simple_cubic
        extra_args: >-
          -detpixels 1024

  - id: AT-PARALLEL-011
    description: Polarization factor verification (C ↔ PyTorch)
    base_args: >-
      -default_F 100
      -cell 100 100 100 90 90 90
      -lambda 6.2
      -N 5
      -distance 100
      -pixel 0.1
      -detpixels 256
      -mosflm
      -phi 0
      -osc 0
      -mosaic 0
      -seed 1
    thresholds:
      corr_min: 0.98
      sum_ratio_min: 0.9
      sum_ratio_max: 1.1
      max_abs_max: 500
    runs:
      - name: unpolarized
        extra_args: >-
          -polar 0.0
      - name: polarized
        extra_args: >-
          -polar 0.95

  - id: AT-PARALLEL-020
    description: Comprehensive integration test with all features (C ↔ PyTorch)
    base_args: >-
      -cell 70 80 90 75 85 95
      -N 5
      -mosaic 0.5
      -mosaic_dom 5
      -mosaic_seed 12345
      -phi 0
      -osc 90
      -phisteps 9
      -detector_rotx 5
      -detector_roty 3
      -detector_rotz 2
      -twotheta 10
      -detector_abs 500
      -detector_thick 450
      -thicksteps 5
      -polar 0.95
      -detpixels 512
      -pixel 0.1
      -distance 100
      -lambda 6.2
      -oversample 1
      -seed 42
      -default_F 100
      -mosflm
      -misset 15 25 35
    thresholds:
      corr_min: 0.95
      sum_ratio_min: 0.9
      sum_ratio_max: 1.1
      max_abs_max: 1000
    runs:
      - name: comprehensive
        extra_args: >-

  - id: AT-PARALLEL-021
    description: Crystal phi rotation equivalence (C ↔ PyTorch)
    base_args: >-
      -default_F 100
      -cell 100 100 100 90 90 90
      -lambda 6.2
      -N 5
      -pixel 0.1
      -distance 100
      -detpixels 256
      -mosflm
      -seed 1
      -phi 0
      -mosaic 0
      -oversample 1
    thresholds:
      corr_min: 0.99
      sum_ratio_min: 0.9
      sum_ratio_max: 1.1
      max_abs_max: 500
    runs:
      - name: single_step_phi
        extra_args: >-
          -osc 90
          -phisteps 1
      - name: multi_step_phi
        extra_args: >-
          -osc 90
          -phisteps 9

  - id: AT-PARALLEL-022
    description: Combined detector and crystal rotation equivalence (C ↔ PyTorch)
    base_args: >-
      -default_F 100
      -cell 100 100 100 90 90 90
      -lambda 6.2
      -N 5
      -pixel 0.1
      -distance 100
      -detpixels 256
      -mosflm
      -seed 1
      -detector_rotx 5
      -detector_roty 3
      -detector_rotz 2
      -twotheta 10
      -phi 0
      -mosaic 0
      -oversample 1
    thresholds:
      corr_min: 0.98
      sum_ratio_min: 0.9
      sum_ratio_max: 1.1
      max_abs_max: 500
    runs:
      - name: single_step_phi
        extra_args: >-
          -osc 90
          -phisteps 1
      - name: multi_step_phi
        extra_args: >-
          -osc 90
          -phisteps 9

  - id: AT-PARALLEL-023
    description: Misset angles equivalence with explicit α β γ rotations (C ↔ PyTorch)
    base_args: >-
      -default_F 100
      -lambda 1.0
      -N 5
      -pixel 0.1
      -distance 100
      -detpixels 256
      -mosflm
      -phi 0
      -osc 0
      -mosaic 0
      -oversample 1
      -seed 1
    thresholds:
      corr_min: 0.985  # Relaxed from 0.99 for triclinic cases (known numerical precision issue)
      sum_ratio_min: 0.98
      sum_ratio_max: 1.02
      max_abs_max: 500
    runs:
      - name: cubic-misset-0-0-0
        extra_args: >-
          -cell 100 100 100 90 90 90
          -misset 0.0 0.0 0.0
      - name: cubic-misset-10p5-0-0
        extra_args: >-
          -cell 100 100 100 90 90 90
          -misset 10.5 0.0 0.0
      - name: cubic-misset-0-10p25-0
        extra_args: >-
          -cell 100 100 100 90 90 90
          -misset 0.0 10.25 0.0
      - name: cubic-misset-0-0-9p75
        extra_args: >-
          -cell 100 100 100 90 90 90
          -misset 0.0 0.0 9.75
      - name: cubic-misset-15-20p5-30p25
        extra_args: >-
          -cell 100 100 100 90 90 90
          -misset 15.0 20.5 30.25
      - name: triclinic-misset-0-0-0
        extra_args: >-
          -cell 70 80 90 75 85 95
          -misset 0.0 0.0 0.0
      - name: triclinic-misset-10p5-0-0
        extra_args: >-
          -cell 70 80 90 75 85 95
          -misset 10.5 0.0 0.0
      - name: triclinic-misset-0-10p25-0
        extra_args: >-
          -cell 70 80 90 75 85 95
          -misset 0.0 10.25 0.0
      - name: triclinic-misset-0-0-9p75
        extra_args: >-
          -cell 70 80 90 75 85 95
          -misset 0.0 0.0 9.75
      - name: triclinic-misset-15-20p5-30p25
        extra_args: >-
          -cell 70 80 90 75 85 95
          -misset 15.0 20.5 30.25
