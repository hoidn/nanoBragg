# Phase D6 Cleanup Commands
# Date: 2025-10-10
# Task: Remove NB_TRACE_SIM_F_LATT instrumentation from simulator.py

# 1. Git diff path
git diff src/nanobrag_torch/simulator.py

# 2. Pytest collection (before)
NB_RUN_PARALLEL=1 KMP_DUPLICATE_LIB_OK=TRUE pytest --collect-only -q

# 3. Edit: Removed lines 312-367 (env-guarded trace block)
# File: src/nanobrag_torch/simulator.py
# Change: Deleted NB_TRACE_SIM_F_LATT environment guard and logging

# 4. Pytest collection (after)
NB_RUN_PARALLEL=1 KMP_DUPLICATE_LIB_OK=TRUE pytest --collect-only -q

# 5. ROI parity comparison (verification)
KMP_DUPLICATE_LIB_OK=TRUE python scripts/nb_compare.py --resample --roi 1792 2304 1792 2304 --outdir reports/2026-01-vectorization-parity/phase_d/${STAMP}/cleanup/roi_compare -- -lambda 0.5 -cell 100 100 100 90 90 90 -N 5 -default_F 100 -distance 500 -detpixels 4096 -pixel 0.05
