============================= test session starts ==============================
platform linux -- Python 3.13.5, pytest-8.4.1, pluggy-1.5.0 -- /home/ollie/miniconda3/bin/python3.13
cachedir: .pytest_cache
rootdir: /home/ollie/Documents/tmp/nanoBragg
configfile: pyproject.toml
plugins: anyio-4.9.0
collecting ... collected 76 items

tests/test_at_cli_008.py::TestATCLI008DminFiltering::test_dmin_filtering_reduces_intensity PASSED [  1%]
tests/test_at_cli_008.py::TestATCLI008DminFiltering::test_dmin_very_strict_removes_most_intensity PASSED [  2%]
tests/test_at_cli_008.py::TestATCLI008DminFiltering::test_dmin_zero_has_no_effect PASSED [  3%]
tests/test_at_io_001.py::TestAT_IO_001::test_smv_header_required_keys PASSED [  5%]
tests/test_at_io_001.py::TestAT_IO_001::test_smv_data_ordering PASSED    [  6%]
tests/test_at_io_001.py::TestAT_IO_001::test_smv_convention_specific_headers PASSED [  7%]
tests/test_at_io_001.py::TestAT_IO_001::test_smv_torch_tensor_input PASSED [  9%]
tests/test_at_io_001.py::TestAT_IO_001::test_smv_byte_order PASSED       [ 10%]
tests/test_at_parallel_006.py::TestATParallel006SingleReflection::test_bragg_angle_prediction_single_distance PASSED [ 11%]
tests/test_at_parallel_006.py::TestATParallel006SingleReflection::test_distance_scaling PASSED [ 13%]
tests/test_at_parallel_006.py::TestATParallel006SingleReflection::test_combined_wavelength_and_distance PASSED [ 14%]
tests/test_at_parallel_016.py::TestATParallel016ExtremeScale::test_tiny_scale PASSED [ 15%]
tests/test_at_parallel_016.py::TestATParallel016ExtremeScale::test_large_cell PASSED [ 17%]
tests/test_at_parallel_016.py::TestATParallel016ExtremeScale::test_long_distance PASSED [ 18%]
tests/test_at_parallel_016.py::TestATParallel016ExtremeScale::test_extreme_scale_c_comparison SKIPPED [ 19%]
tests/test_at_parallel_016.py::TestATParallel016ExtremeScale::test_combined_extremes PASSED [ 21%]
tests/test_at_parallel_016.py::TestATParallel016ExtremeScale::test_numerical_stability_metrics PASSED [ 22%]
tests/test_at_parallel_027.py::TestAT_PARALLEL_027::test_structure_factor_loading PASSED [ 23%]
tests/test_at_parallel_027.py::TestAT_PARALLEL_027::test_intensity_ratios PASSED [ 25%]
tests/test_at_parallel_027.py::TestAT_PARALLEL_027::test_pattern_structure PASSED [ 26%]
tests/test_at_parallel_027.py::TestAT_PARALLEL_027::test_c_pytorch_equivalence SKIPPED [ 27%]
tests/test_at_parallel_027.py::TestAT_PARALLEL_027::test_f_squared_scaling PASSED [ 28%]
tests/test_at_perf_008.py::TestATPERF008CUDATensorResidency::test_large_tensor_gpu_residency SKIPPED [ 30%]
tests/test_at_perf_008.py::TestATPERF008CUDATensorResidency::test_auto_device_selection_uses_cuda SKIPPED [ 31%]
tests/test_at_perf_008.py::TestATPERF008CUDATensorResidency::test_skip_when_cuda_unavailable PASSED [ 32%]
tests/test_at_perf_008.py::TestATPERF008CUDATensorResidency::test_memory_efficient_gpu_usage SKIPPED [ 34%]
tests/test_at_src_001_simple.py::test_sourcefile_dtype_propagation[dtype0] PASSED [ 35%]
tests/test_at_src_001_simple.py::test_sourcefile_dtype_propagation[dtype1] PASSED [ 36%]
tests/test_at_src_001_simple.py::test_sourcefile_dtype_propagation[None] PASSED [ 38%]
tests/test_at_src_001_simple.py::test_sourcefile_parsing PASSED          [ 39%]
tests/test_cli_flags.py::TestPix0VectorAlias::test_pix0_meters_alias PASSED [ 40%]
tests/test_cli_flags.py::TestPix0VectorAlias::test_pix0_millimeter_alias PASSED [ 42%]
tests/test_cli_flags.py::TestPix0VectorAlias::test_pix0_meters_and_mm_equivalence PASSED [ 43%]
tests/test_cli_flags.py::TestPix0VectorAlias::test_dual_pix0_flag_rejection PASSED [ 44%]
tests/test_cli_flags.py::TestPix0VectorAlias::test_pix0_signed_combinations[pix0_m0-pix0_mm0] PASSED [ 46%]
tests/test_cli_flags.py::TestPix0VectorAlias::test_pix0_signed_combinations[pix0_m1-pix0_mm1] PASSED [ 47%]
tests/test_cli_flags.py::TestPix0VectorAlias::test_pix0_signed_combinations[pix0_m2-pix0_mm2] PASSED [ 48%]
tests/test_cli_flags.py::TestDetectorOverridePersistence::test_detector_override_persistence_cpu PASSED [ 50%]
tests/test_cli_flags.py::TestDetectorOverridePersistence::test_detector_override_persistence_cuda SKIPPED [ 51%]
tests/test_cli_flags.py::TestDetectorOverridePersistence::test_detector_override_dtype_preservation PASSED [ 52%]
tests/test_cli_flags.py::TestNoiseSuppressionFlag::test_nonoise_suppresses_noise_output PASSED [ 53%]
tests/test_cli_flags.py::TestNoiseSuppressionFlag::test_noisefile_without_nonoise PASSED [ 55%]
tests/test_cli_flags.py::TestNoiseSuppressionFlag::test_nonoise_preserves_seed PASSED [ 56%]
tests/test_cli_flags.py::TestNoiseSuppressionFlag::test_nonoise_without_noisefile PASSED [ 57%]
tests/test_cli_flags.py::TestCLIIntegrationSanity::test_pix0_does_not_alter_beam_vector PASSED [ 59%]
tests/test_cli_flags.py::TestCLIIntegrationSanity::test_pix0_triggers_custom_convention PASSED [ 60%]
tests/test_cli_flags.py::TestCLIIntegrationSanity::test_roi_unaffected_by_new_flags PASSED [ 61%]
tests/test_cli_flags.py::TestCLIIntegrationSanity::test_convention_preserved_without_pix0 PASSED [ 63%]
tests/test_cli_flags.py::TestCLIBeamVector::test_custom_beam_vector_propagates PASSED [ 64%]
tests/test_cli_flags.py::TestCLIPix0Override::test_pix0_override_beam_pivot_transform[cpu-dtype0] PASSED [ 65%]
tests/test_cli_flags.py::TestCLIPix0Override::test_pix0_override_beam_pivot_transform[cuda-dtype1] SKIPPED [ 67%]
tests/test_cli_flags.py::TestCLIPix0Override::test_pix0_vector_mm_beam_pivot[cpu] PASSED [ 68%]
tests/test_cli_flags.py::TestCLIPix0Override::test_pix0_vector_mm_beam_pivot[cuda] SKIPPED [ 69%]
tests/test_cli_flags.py::TestCLIPolarization::test_default_polarization_parity PASSED [ 71%]
tests/test_cli_flags.py::TestCLIPolarization::test_nopolar_flag PASSED   [ 72%]
tests/test_cli_flags.py::TestCLIPolarization::test_polar_override PASSED [ 73%]
tests/test_cli_flags.py::TestCLIPivotSelection::test_custom_vectors_force_sample_pivot[float32-cpu] PASSED [ 75%]
tests/test_cli_flags.py::TestCLIPivotSelection::test_custom_vectors_force_sample_pivot[float32-cuda] SKIPPED [ 76%]
tests/test_cli_flags.py::TestCLIPivotSelection::test_custom_vectors_force_sample_pivot[float64-cpu] PASSED [ 77%]
tests/test_cli_flags.py::TestCLIPivotSelection::test_custom_vectors_force_sample_pivot[float64-cuda] SKIPPED [ 78%]
tests/test_cli_flags.py::TestHKLFdumpParity::test_scaled_hkl_roundtrip PASSED [ 80%]
tests/test_detector_geometry.py::TestDetectorGeometryRegressions::test_rotated_basis_vectors_match_c_reference PASSED [ 81%]
tests/test_detector_geometry.py::TestDetectorGeometryRegressions::test_pix0_vector_matches_c_reference_in_beam_pivot PASSED [ 82%]
tests/test_detector_geometry.py::TestDetectorGeometryRegressions::test_mosflm_axis_mapping_correctness PASSED [ 84%]
tests/test_detector_geometry.py::TestDetectorDifferentiability::test_detector_parameter_gradients PASSED [ 85%]
tests/test_detector_geometry.py::TestDetectorDifferentiability::test_basis_vector_gradients PASSED [ 86%]
tests/test_detector_geometry.py::TestDetectorDifferentiability::test_pixel_coords_basis_vector_gradients PASSED [ 88%]
tests/test_detector_geometry.py::TestDetectorDifferentiability::test_comprehensive_gradcheck PASSED [ 89%]
tests/test_detector_geometry.py::TestDetectorDifferentiability::test_beam_strike_invariant_in_beam_pivot_mode PASSED [ 90%]
tests/test_detector_geometry.py::TestDetectorDifferentiability::test_xds_convention_basic_geometry PASSED [ 92%]
tests/test_detector_geometry.py::TestDetectorDifferentiability::test_detector_real_valued_gradients PASSED [ 93%]
tests/test_detector_geometry.py::TestDetectorDifferentiability::test_detector_complex_gradient_edge_cases PASSED [ 94%]
tests/test_detector_geometry.py::TestDetectorDifferentiability::test_simulator_real_valued_gradients PASSED [ 96%]
tests/test_perf_pytorch_006.py::test_dtype_support[dtype0] PASSED        [ 97%]
tests/test_perf_pytorch_006.py::test_dtype_support[dtype1] PASSED        [ 98%]
tests/test_perf_pytorch_006.py::test_float32_float64_correlation PASSED  [100%]

=============================== warnings summary ===============================
tests/test_at_src_001_simple.py::test_sourcefile_parsing
  /home/ollie/Documents/tmp/nanoBragg/tests/test_at_src_001_simple.py:71: UserWarning: Sourcefile wavelength column differs from CLI -lambda value. Per spec-a-core.md:150-151, sourcefile wavelengths are ignored. All sources will use CLI wavelength 6.200000e-10 m.
    directions, weights, wavelengths = read_sourcefile(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
============================= slowest 25 durations =============================
13.95s call     tests/test_at_cli_008.py::TestATCLI008DminFiltering::test_dmin_filtering_reduces_intensity
12.78s call     tests/test_at_cli_008.py::TestATCLI008DminFiltering::test_dmin_zero_has_no_effect
6.66s call     tests/test_at_cli_008.py::TestATCLI008DminFiltering::test_dmin_very_strict_removes_most_intensity
3.22s call     tests/test_at_parallel_006.py::TestATParallel006SingleReflection::test_bragg_angle_prediction_single_distance
3.14s call     tests/test_detector_geometry.py::TestDetectorDifferentiability::test_simulator_real_valued_gradients
1.95s call     tests/test_at_parallel_027.py::TestAT_PARALLEL_027::test_intensity_ratios
1.67s call     tests/test_at_parallel_016.py::TestATParallel016ExtremeScale::test_tiny_scale
1.64s call     tests/test_at_parallel_006.py::TestATParallel006SingleReflection::test_distance_scaling
1.60s call     tests/test_at_parallel_016.py::TestATParallel016ExtremeScale::test_long_distance
1.55s call     tests/test_perf_pytorch_006.py::test_dtype_support[dtype1]
0.42s call     tests/test_at_parallel_016.py::TestATParallel016ExtremeScale::test_large_cell
0.31s call     tests/test_cli_flags.py::TestHKLFdumpParity::test_scaled_hkl_roundtrip
0.10s call     tests/test_detector_geometry.py::TestDetectorDifferentiability::test_detector_parameter_gradients
0.09s call     tests/test_at_parallel_006.py::TestATParallel006SingleReflection::test_combined_wavelength_and_distance
0.08s call     tests/test_perf_pytorch_006.py::test_float32_float64_correlation
0.02s call     tests/test_detector_geometry.py::TestDetectorDifferentiability::test_comprehensive_gradcheck
0.01s call     tests/test_detector_geometry.py::TestDetectorDifferentiability::test_beam_strike_invariant_in_beam_pivot_mode
0.01s call     tests/test_detector_geometry.py::TestDetectorDifferentiability::test_pixel_coords_basis_vector_gradients
0.01s call     tests/test_at_parallel_016.py::TestATParallel016ExtremeScale::test_combined_extremes
0.01s call     tests/test_detector_geometry.py::TestDetectorDifferentiability::test_detector_real_valued_gradients
0.01s call     tests/test_detector_geometry.py::TestDetectorDifferentiability::test_basis_vector_gradients
0.01s call     tests/test_at_parallel_027.py::TestAT_PARALLEL_027::test_pattern_structure
0.01s call     tests/test_at_perf_008.py::TestATPERF008CUDATensorResidency::test_skip_when_cuda_unavailable
0.01s call     tests/test_perf_pytorch_006.py::test_dtype_support[dtype0]

(1 durations < 0.005s hidden.  Use -vv to show these durations.)
================== 66 passed, 10 skipped, 1 warning in 51.90s ==================
