============================= test session starts ==============================
platform linux -- Python 3.13.5, pytest-8.4.1, pluggy-1.5.0 -- /home/ollie/miniconda3/bin/python3.13
cachedir: .pytest_cache
rootdir: /home/ollie/Documents/tmp/nanoBragg
configfile: pyproject.toml
plugins: anyio-4.9.0
collecting ... collected 1 item

tests/test_at_cli_002.py::TestAT_CLI_002::test_minimal_render_with_default_F FAILED [100%]

=================================== FAILURES ===================================
______________ TestAT_CLI_002.test_minimal_render_with_default_F _______________

self = <tests.test_at_cli_002.TestAT_CLI_002 object at 0x7723f3da7ed0>

    def test_minimal_render_with_default_F(self):
        """AT-CLI-002: Run minimal simulation with -default_F and verify outputs."""
    
        with tempfile.TemporaryDirectory() as tmpdir:
            floatfile = os.path.join(tmpdir, 'output.bin')
            intfile = os.path.join(tmpdir, 'output.img')
    
            # Run the simulation
            cmd = [
                sys.executable, '-m', 'nanobrag_torch',
                '-cell', '100', '100', '100', '90', '90', '90',  # Simple cubic
                '-default_F', '100',
                '-detpixels', '32',
                '-pixel', '0.1',
                '-distance', '100',
                '-lambda', '6.2',  # Wavelength
                '-N', '5',  # Crystal size
                '-floatfile', floatfile,
                '-intfile', intfile
            ]
    
            result = subprocess.run(cmd, capture_output=True, text=True)
            assert result.returncode == 0, f"Command failed: {result.stderr}"
    
            # Check that files were created
            assert os.path.exists(floatfile), "Float file was not created"
            assert os.path.exists(intfile), "SMV file was not created"
    
            # Read and verify float file
            float_data = np.fromfile(floatfile, dtype=np.float32).reshape(32, 32)
            assert float_data.shape == (32, 32)
>           assert np.any(float_data > 0), "Float image should have non-zero values"
E           AssertionError: Float image should have non-zero values
E           assert np.False_
E            +  where np.False_ = <function any at 0x7723f3d330f0>(array([[0., 0., 0., ..., 0., 0., 0.],\n       [0., 0., 0., ..., 0., 0., 0.],\n       [0., 0., 0., ..., 0., 0., 0.],\n       ...,\n       [0., 0., 0., ..., 0., 0., 0.],\n       [0., 0., 0., ..., 0., 0., 0.],\n       [0., 0., 0., ..., 0., 0., 0.]], shape=(32, 32), dtype=float32) > 0)
E            +    where <function any at 0x7723f3d330f0> = np.any

tests/test_at_cli_002.py:59: AssertionError
=========================== short test summary info ============================
FAILED tests/test_at_cli_002.py::TestAT_CLI_002::test_minimal_render_with_default_F - AssertionError: Float image should have non-zero values
assert np.False_
 +  where np.False_ = <function any at 0x7723f3d330f0>(array([[0., 0., 0., ..., 0., 0., 0.],\n       [0., 0., 0., ..., 0., 0., 0.],\n       [0., 0., 0., ..., 0., 0., 0.],\n       ...,\n       [0., 0., 0., ..., 0., 0., 0.],\n       [0., 0., 0., ..., 0., 0., 0.],\n       [0., 0., 0., ..., 0., 0., 0.]], shape=(32, 32), dtype=float32) > 0)
 +    where <function any at 0x7723f3d330f0> = np.any
============================== 1 failed in 4.87s ===============================
Exit code: 1
