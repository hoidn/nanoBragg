# TEST-SUITE-TRIAGE-001 Phase A Preflight Report

**Timestamp:** 2025-10-10T13:10:00Z
**Phase:** A (Environment Capture & Collection Snapshot)
**Status:** ✅ COMPLETE
**Ledger Item:** [TEST-SUITE-TRIAGE-001]

## Executive Summary

Phase A preflight successfully captured environment metadata, disk headroom, and pytest collection baseline. All tasks A1-A3 from `plans/active/test-suite-triage.md` are complete.

**Key Metrics:**
- **Total Tests Collected:** 692
- **Collection Status:** SUCCESS (0 errors)
- **Disk Availability:** 77G available (83% used)
- **PyTorch Version:** 2.7.1+cu126
- **CUDA Available:** Yes (NVIDIA GeForce RTX 3090)

## Phase A Task Completion

### A1: Environment Snapshot
✅ **Status:** Complete

**Python Environment:**
- Python Version: 3.13
- Site Packages: `/home/ollie/miniconda3/lib/python3.13/site-packages`
- Project Source: `/home/ollie/Documents/tmp/nanoBragg/src` (in sys.path)

**PyTorch/CUDA:**
- PyTorch: 2.7.1+cu126
- CUDA: 12.6
- GPU: NVIDIA GeForce RTX 3090 (1 device)

**Artifacts:**
- `env.txt` — Python site information
- `torch_env.txt` — PyTorch and CUDA details

### A2: Disk Audit
✅ **Status:** Complete

**Filesystem:** /dev/nvme0n1p2
**Capacity:** 457G total, 357G used, 77G available (83% usage)
**Assessment:** Sufficient headroom for test artifacts and junit XML outputs.

**Artifact:**
- `disk_usage.txt` — Full df output

### A3: Collection Snapshot
✅ **Status:** Complete

**Command:**
```bash
env KMP_DUPLICATE_LIB_OK=TRUE pytest --collect-only tests -q
```

**Results:**
- **Total Tests:** 692
- **Collection Errors:** 0
- **Exit Status:** 0 (SUCCESS)

**Artifact:**
- `collect_only.log` — Complete pytest collection output (692 test nodes)

## Test Suite Breakdown

The 692 collected tests span the following categories (based on file name analysis):

### Acceptance Tests (AT)
- **AT-ABS-001:** Absorption (16 tests, CPU+CUDA parametrized)
- **AT-BKG-001:** Water background (3 tests)
- **AT-CLI-001 to AT-CLI-009:** CLI interface (48+ tests)
- **AT-GEO-001 to AT-GEO-006:** Detector geometry (28+ tests)
- **AT-IO-001 to AT-IO-004:** File I/O (SMV, PGM, Fdump, HKL) (32+ tests)
- **AT-NOISE-001:** Poisson noise regimes (7 tests)
- **AT-PARALLEL-001 to AT-PARALLEL-029:** C↔PyTorch equivalence (200+ tests)
- **AT-PERF-001 to AT-PERF-008:** Performance benchmarks (40+ tests)
- **AT-POL-001:** Polarization (Kahn model) (5 tests)
- **AT-PRE-001 to AT-PRE-002:** Precedence rules (9 tests)
- **AT-ROI-001:** Region of interest (7 tests)
- **AT-SAM-001 to AT-SAM-003:** Sampling (steps, oversample, dmin) (7 tests)
- **AT-SRC-001 to AT-SRC-003:** Source files and divergence (30+ tests)
- **AT-FLU-001:** Fluence calculations (8 tests)

### Component/Integration Tests
- Crystal geometry and gradients
- Detector geometry and gradients
- Simulator integration tests
- Tricubic interpolation (vectorized)

### Gradient Tests
- Parameter gradient checks (torch.autograd.gradcheck)
- Differentiability preservation tests

## Guardrails & Constraints

**From `docs/development/pytorch_runtime_checklist.md` and `arch.md` §15:**
- Device/dtype neutrality: tests parametrized across CPU/CUDA
- Vectorization discipline: no Python loops in physics kernels
- KMP_DUPLICATE_LIB_OK=TRUE required for all torch imports

**Protected Assets (per `docs/index.md`):**
- `loop.sh`, `supervisor.sh`, `input.md` — not to be deleted during hygiene

## Next Actions (Phase B)

Per `plans/active/test-suite-triage.md`, the next step is:

**Phase B: Full Suite Execution**
- Command: `KMP_DUPLICATE_LIB_OK=TRUE pytest tests/ -v --durations=25 --maxfail=0 --junitxml=reports/2026-01-test-suite-triage/phase_b/<STAMP>/pytest_full.xml`
- Artifacts: `phase_b/<STAMP>/pytest_full.log`, `pytest_full.xml`
- Success Criteria: Capture all failures, warnings, and timings for triage in Phase C

**Blocker Check:** None identified. Environment is ready for full-suite run.

## Artifact Index

All artifacts stored under:
```
reports/2026-01-test-suite-triage/phase_a/20251010T131000Z/
```

**Files:**
1. `preflight.md` — This report
2. `commands.txt` — Reproduction commands
3. `env.txt` — Python site information
4. `torch_env.txt` — PyTorch/CUDA environment
5. `disk_usage.txt` — Disk headroom snapshot
6. `collect_only.log` — Full pytest collection output (692 tests)

## Sign-Off

**Phase A Status:** ✅ COMPLETE
**Ready for Phase B:** YES
**Blockers:** None

---
*Report generated by Ralph loop following `input.md` Do Now directive for TEST-SUITE-TRIAGE-001 Phase A.*
