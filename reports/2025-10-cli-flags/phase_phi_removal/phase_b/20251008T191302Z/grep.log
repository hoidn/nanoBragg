input.md:23:- reports/2025-10-cli-flags/phase_phi_removal/phase_b/<timestamp>/grep.log — output of rg search for residual `phi_carryover_mode` references.
input.md:30:- No residual references to `phi_carryover_mode` remain outside components explicitly deferred to Phase B2/B3.
input.md:45:- Edit src/nanobrag_torch/__main__.py: remove the argument definition, help text, and config wiring for `phi_carryover_mode` while keeping formatting tidy.
input.md:49:- Search for remaining references: `rg "phi_carryover_mode" -n | tee reports/.../${ts}/grep.log` and annotate any leftover call sites for Phase B2.
input.md:83:- Record in summary.md the config/simulator call sites still referencing `phi_carryover_mode` for Phase B2 planning.
input.md:84:- Note which tests or tooling will require deletion or updates during Phase B3 (e.g., tests/test_phi_carryover_mode.py).
galph_memory.md:808:- Verified docs/bugs/verified_c_bugs.md:166 continues to quarantine C-PARITY-001 as a defect and the PyTorch default path (`Crystal.get_rotated_real_vectors` lines ~1080-1170) keeps `phi_carryover_mode="spec"` as default.
docs/fix_plan.md:468:    Metrics: Test collection: 35 tests collected successfully in 2.16s (test_cli_scaling_phi0.py + test_phi_carryover_mode.py). Documentation-only loop per input.md Mode: Docs.
docs/fix_plan.md:572:    Metrics: Targeted tests 35/35 passed in 2.67s (test_cli_scaling_phi0.py + test_phi_carryover_mode.py); core geometry tests 66/66 passed in 8.13s. Trace harness executed successfully (114 TRACE_PY lines captured, pixel 685,1039 final intensity 2.875e-07).
docs/fix_plan.md:592:    Metrics: Script execution successful; targeted tests 35/35 passed in 2.65s (test_cli_scaling_phi0.py + test_phi_carryover_mode.py). Scaling comparison: first_divergence=I_before_scaling (C: 943654.809, PyTorch: 941686.236, Δrel: -2.086e-03).
docs/fix_plan.md:637:    Metrics: Evidence-only loop per input.md Do Now directive. Test collection: 35 tests (2 in test_cli_scaling_phi0.py + 33 in test_phi_carryover_mode.py).
docs/fix_plan.md:647:      - `reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T075949Z/pytest_collect.log` — Test collection logs (test_cli_scaling_phi0.py and test_phi_carryover_mode.py)
docs/fix_plan.md:901:    Metrics: Test collection: 34 tests collected successfully (tests/test_cli_scaling_phi0.py + tests/test_phi_carryover_mode.py). Evidence-only — no pytest execution this loop.
docs/fix_plan.md:919:    Metrics: Test collection: 35 tests collected successfully (tests/test_cli_scaling_phi0.py + tests/test_phi_carryover_mode.py). Evidence-only — no pytest execution this loop.
docs/fix_plan.md:964:      - **Config plumbing**: `CrystalConfig.phi_carryover_mode` field; parser updates in `__main__.py`
docs/fix_plan.md:980:    Metrics: Targeted tests PASSED (6/6 in 4.25s). Smoke tests: test_cli_scaling_phi0.py 2/2 passed, test_at_geo_001.py 1/1 passed, test_at_crystal_absolute.py 3/3 passed. Config validation: phi_carryover_mode invalid rejection working. No regressions detected.
docs/fix_plan.md:982:      - `src/nanobrag_torch/config.py:56-59` — Added `phi_carryover_mode: str = "spec"` field to CrystalConfig
docs/fix_plan.md:993:      - **Default is spec-compliant**: phi_carryover_mode="spec" produces fresh rotations; validates against C-PARITY-001 documentation
docs/fix_plan.md:1101:    Metrics: Spec mode Δk(φ₀)=1.811649e-02 (expected spec divergence); c-parity max Δk=2.8451466e-05 (>1e-6) and max ΔF_latt_b=4.36e-03 (>1e-4). Targeted pytest `--collect-only` for `tests/test_cli_scaling_phi0.py` and `tests/test_phi_carryover_mode.py` succeeded (699 tests collected).
docs/fix_plan.md:1214:      - **Spec compliance reconfirmed**: Default `phi_carryover_mode="spec"` behavior correct (specs/spec-a-core.md:211)
docs/fix_plan.md:2771:      - `reports/2025-10-cli-flags/phase_l/scaling_audit/trace_harness.py:165` — Routed `args.phi_mode` to `crystal_config.phi_carryover_mode`
docs/fix_plan.md:2772:      - `reports/2025-10-cli-flags/phase_l/scaling_audit/trace_harness.py:202` — Added phi_carryover_mode to config snapshot
docs/fix_plan.md:3387:        * Call sequence: Initialize cache in Crystal, store φ=final values during `_compute_physics_for_position`, apply carryover when `phi_carryover_mode="c-parity"`
docs/fix_plan.md:3812:      - Test collection: 35 tests collected successfully in 2.17s (pytest --collect-only -q tests/test_cli_scaling_phi0.py tests/test_phi_carryover_mode.py)
docs/fix_plan.md:3885:      - `reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/phi_carryover_refs.txt` — Raw grep results for all phi_carryover_mode references
docs/fix_plan.md:3892:      - **Shim surface area quantified**: 4 production files (`__main__.py`, `config.py`, `crystal.py`, `simulator.py`), 2 test files (`test_phi_carryover_mode.py`, `test_cli_scaling_parity.py`), 3 active plans, and 40+ historical report bundles reference the φ carryover shim
docs/fix_plan.md:3910:      - **Shim surface area confirmed**: 4 production files (`__main__.py`, `config.py`, `crystal.py`, `simulator.py`), 1 test file to delete (`test_phi_carryover_mode.py`), 1 test file to keep (`test_cli_scaling_phi0.py`)
docs/fix_plan.md:3918:      - Phase B2: Remove `phi_carryover_mode` field from `config.py` (lines 154, 165-168); delete `apply_phi_carryover()` method from `crystal.py` (lines 245-388); remove c-parity branching from `simulator.py` (line 767)
docs/fix_plan.md:3919:      - Phase B3: Delete `tests/test_phi_carryover_mode.py`; verify `tests/test_cli_scaling_phi0.py` remains green
tests/test_phi_carryover_mode.py:39:        """Verify default phi_carryover_mode is 'spec' (spec-compliant)."""
tests/test_phi_carryover_mode.py:45:        assert args.phi_carryover_mode == 'spec', \
tests/test_phi_carryover_mode.py:56:        assert args.phi_carryover_mode == 'spec'
tests/test_phi_carryover_mode.py:66:        assert args.phi_carryover_mode == 'c-parity'
tests/test_phi_carryover_mode.py:81:    """Test CrystalConfig validation for phi_carryover_mode."""
tests/test_phi_carryover_mode.py:86:        assert config.phi_carryover_mode == 'spec'
tests/test_phi_carryover_mode.py:90:        config = CrystalConfig(phi_carryover_mode='spec')
tests/test_phi_carryover_mode.py:91:        assert config.phi_carryover_mode == 'spec'
tests/test_phi_carryover_mode.py:95:        config = CrystalConfig(phi_carryover_mode='c-parity')
tests/test_phi_carryover_mode.py:96:        assert config.phi_carryover_mode == 'c-parity'
tests/test_phi_carryover_mode.py:100:        with pytest.raises(ValueError, match="phi_carryover_mode must be"):
tests/test_phi_carryover_mode.py:101:            CrystalConfig(phi_carryover_mode='invalid')
tests/test_phi_carryover_mode.py:124:        assert args.phi_carryover_mode == 'spec'
tests/test_phi_carryover_mode.py:130:            phi_carryover_mode=args.phi_carryover_mode
tests/test_phi_carryover_mode.py:133:        assert crystal_config.phi_carryover_mode == 'spec'
tests/test_phi_carryover_mode.py:149:        assert args.phi_carryover_mode == 'c-parity'
tests/test_phi_carryover_mode.py:154:            phi_carryover_mode=args.phi_carryover_mode
tests/test_phi_carryover_mode.py:157:        assert crystal_config.phi_carryover_mode == 'c-parity'
tests/test_phi_carryover_mode.py:161:    """Test that phi_carryover_mode affects rotation behavior correctly."""
tests/test_phi_carryover_mode.py:186:            phi_carryover_mode='spec'
tests/test_phi_carryover_mode.py:229:            phi_carryover_mode='c-parity'
tests/test_phi_carryover_mode.py:269:            phi_carryover_mode='spec'
tests/test_phi_carryover_mode.py:279:            phi_carryover_mode='c-parity'
tests/test_phi_carryover_mode.py:312:            phi_carryover_mode=mode
tests/test_phi_carryover_mode.py:334:            phi_carryover_mode=mode
tests/test_phi_carryover_mode.py:357:            phi_carryover_mode='c-parity'
tests/test_phi_carryover_mode.py:376:            phi_carryover_mode='c-parity'
tests/test_phi_carryover_mode.py:393:            phi_carryover_mode='c-parity'
tests/test_cli_scaling_parity.py:31:        This test validates that when using phi_carryover_mode='c-parity' (which
tests/test_cli_scaling_parity.py:89:            phi_carryover_mode="c-parity"
reports/2025-12-cli-flags/phase_l/spec_baseline_refresh/summary.md:32:The tests verify that the default `phi_carryover_mode="spec"` behavior remains correct:
reports/2025-10-cli-flags/phase_c2/implementation_summary.md:20:phi_carryover_mode: str = "spec"
reports/2025-10-cli-flags/phase_c2/implementation_summary.md:25:# Validate phi_carryover_mode
reports/2025-10-cli-flags/phase_c2/implementation_summary.md:26:if self.phi_carryover_mode not in ["spec", "c-parity"]:
reports/2025-10-cli-flags/phase_c2/implementation_summary.md:28:        f"phi_carryover_mode must be 'spec' or 'c-parity', got '{self.phi_carryover_mode}'"
reports/2025-10-cli-flags/phase_c2/implementation_summary.md:53:    phi_carryover_mode=args.phi_carryover_mode
reports/2025-10-cli-flags/phase_c2/implementation_summary.md:57:### 3. `/home/ollie/Documents/tmp/nanoBragg/tests/test_phi_carryover_mode.py`
reports/2025-10-cli-flags/phase_c2/implementation_summary.md:87:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_default_mode_is_spec PASSED
reports/2025-10-cli-flags/phase_c2/implementation_summary.md:88:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_spec_mode_explicit PASSED
reports/2025-10-cli-flags/phase_c2/implementation_summary.md:89:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_c_parity_mode_explicit PASSED
reports/2025-10-cli-flags/phase_c2/implementation_summary.md:90:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_invalid_mode_rejected PASSED
reports/2025-10-cli-flags/phase_c2/implementation_summary.md:130:- CrystalConfig field: `phi_carryover_mode` with default "spec"
reports/2025-10-cli-flags/phase_c2/implementation_summary.md:154:if config.phi_carryover_mode == "c-parity":
reports/2025-10-cli-flags/phase_c2/implementation_summary.md:202:- Test File: `tests/test_phi_carryover_mode.py`
reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:26:phi_carryover_mode: str = "spec"
reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:34:# Validate phi_carryover_mode
reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:35:if self.phi_carryover_mode not in ["spec", "c-parity"]:
reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:37:        f"phi_carryover_mode must be 'spec' or 'c-parity', got '{self.phi_carryover_mode}'"
reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:48:    phi_carryover_mode=args.phi_carryover_mode
reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:53:**File:** `/home/ollie/Documents/tmp/nanoBragg/tests/test_phi_carryover_mode.py`
reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:97:KMP_DUPLICATE_LIB_OK=TRUE pytest tests/test_phi_carryover_mode.py -v
reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:116:**Integration:** Crystal class reads `config.phi_carryover_mode` and applies parity shim when mode="c-parity"
reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:127:4. **Test File:** `tests/test_phi_carryover_mode.py`
reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:161:3. `tests/test_phi_carryover_mode.py` (new file, 33 tests)
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:3:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_default_mode_is_spec
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:4:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_spec_mode_explicit
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:5:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_c_parity_mode_explicit
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:6:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_invalid_mode_rejected
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:7:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_default_config_mode
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:8:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_spec_mode_validation
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:9:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_c_parity_mode_validation
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:10:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_invalid_mode_raises_valueerror
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:11:tests/test_phi_carryover_mode.py::TestCLIToConfigWiring::test_spec_mode_wiring
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:12:tests/test_phi_carryover_mode.py::TestCLIToConfigWiring::test_c_parity_mode_wiring
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:13:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype0]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:14:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype1]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:15:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype2]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:16:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype3]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:17:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype0]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:18:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype1]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:19:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype2]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:20:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype3]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:21:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype0]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:22:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype1]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:23:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype2]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:24:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype3]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:25:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype0-spec]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:26:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype0-c-parity]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:27:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype1-spec]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:28:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype1-c-parity]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:29:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype0-spec]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:30:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype0-c-parity]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:31:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype1-spec]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:32:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype1-c-parity]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:33:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_misset
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:34:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_mosaic
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:35:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_single_phi_step
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:3:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_default_mode_is_spec
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:4:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_spec_mode_explicit
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:5:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_c_parity_mode_explicit
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:6:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_invalid_mode_rejected
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:7:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_default_config_mode
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:8:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_spec_mode_validation
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:9:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_c_parity_mode_validation
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:10:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_invalid_mode_raises_valueerror
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:11:tests/test_phi_carryover_mode.py::TestCLIToConfigWiring::test_spec_mode_wiring
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:12:tests/test_phi_carryover_mode.py::TestCLIToConfigWiring::test_c_parity_mode_wiring
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:13:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype0]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:14:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype1]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:15:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype2]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:16:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype3]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:17:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype0]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:18:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype1]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:19:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype2]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:20:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype3]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:21:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype0]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:22:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype1]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:23:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype2]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:24:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype3]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:25:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype0-spec]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:26:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype0-c-parity]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:27:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype1-spec]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:28:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype1-c-parity]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:29:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype0-spec]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:30:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype0-c-parity]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:31:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype1-spec]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:32:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype1-c-parity]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:33:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_misset
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:34:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_mosaic
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:35:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_single_phi_step
plans/active/phi-carryover-removal/plan.md:8:  - `tests/test_cli_scaling_phi0.py` & `tests/test_phi_carryover_mode.py` — acceptance and regression coverage that will be pruned or reshaped.
plans/active/phi-carryover-removal/plan.md:21:| A1 | Catalogue shim touchpoints | [X] | List code/tests/docs referencing `phi_carryover_mode` (CLI parser, configs, crystal model, debug harness, docs). Store table in `reports/.../phase_a/baseline_inventory.md` with file paths + rationale. **DONE:** See `reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/baseline_inventory.md` — catalogued 4 production files, 2 test files, 3 plans, 40+ reports. |
plans/active/phi-carryover-removal/plan.md:28:Exit Criteria: CLI/config/model code no longer exposes `phi_carryover_mode`; default behavior confirmed unchanged via targeted tests; documentation/fix_plan synced with removal artifacts under `reports/.../phase_b/`.
plans/active/phi-carryover-removal/plan.md:35:| B2 | Prune config/model plumbing | [ ] | Delete `phi_carryover_mode` parameters from `CrystalConfig`/`SimulatorConfig` (if present) and drop `_apply_phi_carryover` branches in `src/nanobrag_torch/models/crystal.py` & `simulator.py`. Ensure vectorised φ rotation path stays intact; reference the nanoBragg.c snippet per CLAUDE Rule #11 when editing docstrings/comments. |
plans/active/phi-carryover-removal/plan.md:36:| B3 | Retire shim tooling/tests | [ ] | Remove parity-only helpers (e.g., `scripts/compare_per_phi_traces.py` flags) and delete or refactor `tests/test_phi_carryover_mode.py` so only spec-mode assertions remain (migrate reusable checks into `tests/test_cli_scaling_phi0.py`). Update any reports under `reports/2025-10-cli-flags/phase_l/` that the tooling depended on. |
plans/active/phi-carryover-removal/plan.md:47:| C1 | Update pytest coverage | [ ] | Delete `tests/test_phi_carryover_mode.py`; fold any remaining spec assertions into `tests/test_cli_scaling_phi0.py`. Validate selectors via `pytest --collect-only -q tests/test_cli_scaling_phi0.py`. |
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:3:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_default_mode_is_spec
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:4:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_spec_mode_explicit
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:5:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_c_parity_mode_explicit
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:6:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_invalid_mode_rejected
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:7:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_default_config_mode
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:8:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_spec_mode_validation
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:9:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_c_parity_mode_validation
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:10:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_invalid_mode_raises_valueerror
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:11:tests/test_phi_carryover_mode.py::TestCLIToConfigWiring::test_spec_mode_wiring
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:12:tests/test_phi_carryover_mode.py::TestCLIToConfigWiring::test_c_parity_mode_wiring
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:13:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype0]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:14:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype1]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:15:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype2]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:16:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype3]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:17:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype0]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:18:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype1]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:19:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype2]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:20:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype3]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:21:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype0]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:22:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype1]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:23:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype2]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:24:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype3]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:25:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype0-spec]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:26:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype0-c-parity]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:27:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype1-spec]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:28:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype1-c-parity]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:29:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype0-spec]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:30:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype0-c-parity]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:31:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype1-spec]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:32:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype1-c-parity]
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:33:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_misset
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:34:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_mosaic
reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:35:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_single_phi_step
plans/active/cli-phi-parity-shim/plan.md:35:| B2 | Choose API & config plumbing | [D] | ✅ Documented in `design.md` §2-3: CLI flag `--phi-carryover-mode`, `CrystalConfig.phi_carryover_mode` field (default="spec"), parser updates in `__main__.py`. Unambiguous naming; no flag collision. |
plans/active/cli-phi-parity-shim/plan.md:46:| C2 | Update CLI / configs | [D] | ✅ CLI flag `--phi-carryover-mode {spec,c-parity}` and `CrystalConfig.phi_carryover_mode` field landed (`src/nanobrag_torch/__main__.py:377-386`, `config.py:154-171`); validation rejects invalid modes (Attempt #120). |
plans/active/cli-phi-parity-shim/plan.md:47:| C3 | Add regression & parity tests | [D] | ✅ `tests/test_phi_carryover_mode.py` exercises parsing, config wiring, and device/dtype behavior for both modes; `tests/test_cli_scaling_phi0.py` still enforces spec baselines (documented in docs/fix_plan.md Attempt #120). |
reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/commands.txt:10:# Command 2: Search for phi_carryover_mode references across codebase
reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/commands.txt:12:rg -n "phi_carryover_mode"
reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/baseline_inventory.md:10:This document catalogues all references to the `phi_carryover_mode` shim introduced during CLI-FLAGS-003 to replicate C-PARITY-001 (documented in `docs/bugs/verified_c_bugs.md:166-204`). The shim allows opt-in emulation of the C-code bug where φ=0 pixels reuse the previous pixel's final φ rotation state instead of computing fresh rotations per spec (`specs/spec-a-core.md:204-240`).
reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/baseline_inventory.md:17:- **Line 859:** CLI argument passed to `CrystalConfig(phi_carryover_mode=args.phi_carryover_mode)`
reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/baseline_inventory.md:24:- **Default:** `phi_carryover_mode: str = "spec"`
reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/baseline_inventory.md:32:- **Line 1482-1484:** Conditional logic `if config.phi_carryover_mode == "c-parity" and self._phi_cache_initialized:`
reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/baseline_inventory.md:38:- **Reference:** Passes `config.phi_carryover_mode` implicitly via CrystalConfig
reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/baseline_inventory.md:45:### tests/test_phi_carryover_mode.py
reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/baseline_inventory.md:142:- **Risk:** Deleting `test_phi_carryover_mode.py` may drop edge-case coverage
reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/phi_carryover_refs.txt:1:# phi_carryover_mode References (50+ files)
reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/phi_carryover_refs.txt:13:tests/test_phi_carryover_mode.py
reports/2025-10-cli-flags/phase_l/parity_shim/20251201_dtype_probe/analysis_summary.md:88:- Modify `src/nanobrag_torch/models/crystal.py` to force `dtype=torch.float64` when `phi_carryover_mode == 'c-parity'`
reports/2025-10-cli-flags/phase_l/parity_shim/20251201_dtype_probe/analysis_summary.md:107:3. Ensure `tests/test_phi_carryover_mode.py` documents the relaxed tolerance for c-parity
reports/2025-10-cli-flags/phase_l/rot_vector/trace_harness.py:145:    # Inject phi_carryover_mode from --phi-mode flag (Phase L3k.3c.4)
reports/2025-10-cli-flags/phase_l/rot_vector/trace_harness.py:146:    params['crystal']['phi_carryover_mode'] = args.phi_mode
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:8:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype0] PASSED [  8%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:9:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype1] PASSED [ 16%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:10:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype2] PASSED [ 25%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:11:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype3] PASSED [ 33%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:12:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype0] PASSED [ 41%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:13:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype1] PASSED [ 50%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:14:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype2] PASSED [ 58%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:15:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype3] PASSED [ 66%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:16:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype0] PASSED [ 75%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:17:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype1] PASSED [ 83%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:18:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype2] PASSED [ 91%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:19:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype3] PASSED [100%]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/README.md:18:- [ ] Confirm `CrystalConfig.phi_carryover_mode` field can be safely deleted
reports/2025-10-cli-flags/phase_phi_removal/phase_b/README.md:44:- [ ] No references to `phi_carryover_mode` in production code
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/env.json:22:  "notes": "Design-only loop. No code changes. Establishes removal plan for phi_carryover_mode shim."
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:123:    phi_carryover_mode: str = "spec"  # "spec" | "c-parity"
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:126:        if self.phi_carryover_mode not in ("spec", "c-parity"):
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:128:                f"phi_carryover_mode must be 'spec' or 'c-parity', "
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:129:                f"got {self.phi_carryover_mode!r}"
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:156:        phi_carryover_mode=args.phi_carryover_mode,
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:169:│   → CrystalConfig(phi_carryover_mode="c-parity")            │
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:174:│   → self.phi_carryover_mode = config.phi_carryover_mode     │
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:179:│   if config.phi_carryover_mode == "c-parity":               │
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:240:        config: CrystalConfig with phi_carryover_mode setting
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:247:    if config.phi_carryover_mode == "c-parity":
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:359:        # Setup: config with phi_carryover_mode="c-parity"
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:375:        # Setup: config with phi_carryover_mode="spec" (default)
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:395:def test_phi_carryover_mode_parsing():
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:401:    assert args.phi_carryover_mode == "spec"
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:405:    assert args.phi_carryover_mode == "spec"
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:409:    assert args.phi_carryover_mode == "c-parity"
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:524:    phi_carryover_mode="c-parity"  # Opt-in parity mode
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:531:**Default behavior** (`phi_carryover_mode="spec"`) remains spec-compliant with identity rotation at φ=0°.
reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:572:- [ ] `CrystalConfig.phi_carryover_mode` field added with validation
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/commands.txt:10:# Step 3: Search for phi_carryover_mode references
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/commands.txt:11:grep -r "phi_carryover_mode\|phi-carryover-mode" --include="*.py" --include="*.md" . | grep -v ".git" > /tmp/phi_refs.txt
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/commands.txt:15:grep -n -C 3 "phi_carryover_mode\|phi-carryover-mode" src/nanobrag_torch/__main__.py
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/commands.txt:16:grep -n -C 3 "phi_carryover_mode" src/nanobrag_torch/config.py
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/commands.txt:26:# - Phase B2: Remove phi_carryover_mode from config.py, crystal.py, simulator.py
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/commands.txt:27:# - Phase B3: Delete tests/test_phi_carryover_mode.py
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/delta_metrics.json:34:    "test_phi_carryover_mode": "12/12 PASSED",
src/nanobrag_torch/models/crystal.py:1463:            config: CrystalConfig containing rotation parameters and phi_carryover_mode
src/nanobrag_torch/models/crystal.py:1482:        if config.phi_carryover_mode == "c-parity" and self._phi_cache_initialized:
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/design_review.md:46:- Remove `phi_carryover_mode=args.phi_carryover_mode` assignment to CrystalConfig
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/design_review.md:53:- Remove `phi_carryover_mode: str = "spec"` field from CrystalConfig
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/design_review.md:74:- Remove conditional check `if self.crystal.config.phi_carryover_mode == "c-parity":`
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/design_review.md:81:#### 5. `tests/test_phi_carryover_mode.py`
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/design_review.md:164:5. ✅ No references to `phi_carryover_mode` in production code (grep verification)
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/design_review.md:189:3. **B3: Tests/tooling** — Delete `test_phi_carryover_mode.py`, update validation scripts
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/design_review.md:217:- Deliverable: No `phi_carryover_mode` parameters or branching logic
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/design_review.md:220:- Files: `tests/test_phi_carryover_mode.py` (delete)
src/nanobrag_torch/config.py:154:    phi_carryover_mode: str = "spec"
src/nanobrag_torch/config.py:164:        # Validate phi_carryover_mode
src/nanobrag_torch/config.py:165:        if self.phi_carryover_mode not in ["spec", "c-parity"]:
src/nanobrag_torch/config.py:167:                f"phi_carryover_mode must be 'spec' or 'c-parity', got '{self.phi_carryover_mode}'"
src/nanobrag_torch/simulator.py:767:        if self.crystal.config.phi_carryover_mode == "c-parity":
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T011326Z/pytest_phi_carryover.log:9:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype0] PASSED [  8%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T011326Z/pytest_phi_carryover.log:10:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype1] PASSED [ 16%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T011326Z/pytest_phi_carryover.log:11:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype2] SKIPPED [ 25%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T011326Z/pytest_phi_carryover.log:12:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype3] SKIPPED [ 33%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T011326Z/pytest_phi_carryover.log:13:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype0] PASSED [ 41%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T011326Z/pytest_phi_carryover.log:14:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype1] PASSED [ 50%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T011326Z/pytest_phi_carryover.log:15:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype2] SKIPPED [ 58%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T011326Z/pytest_phi_carryover.log:16:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype3] SKIPPED [ 66%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T011326Z/pytest_phi_carryover.log:17:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype0] PASSED [ 75%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T011326Z/pytest_phi_carryover.log:18:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype1] PASSED [ 83%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T011326Z/pytest_phi_carryover.log:19:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype2] SKIPPED [ 91%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T011326Z/pytest_phi_carryover.log:20:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype3] SKIPPED [100%]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:1:input.md:23:- reports/2025-10-cli-flags/phase_phi_removal/phase_b/<timestamp>/grep.log — output of rg search for residual `phi_carryover_mode` references.
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:2:input.md:30:- No residual references to `phi_carryover_mode` remain outside components explicitly deferred to Phase B2/B3.
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:3:input.md:45:- Edit src/nanobrag_torch/__main__.py: remove the argument definition, help text, and config wiring for `phi_carryover_mode` while keeping formatting tidy.
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:4:input.md:49:- Search for remaining references: `rg "phi_carryover_mode" -n | tee reports/.../${ts}/grep.log` and annotate any leftover call sites for Phase B2.
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:5:input.md:83:- Record in summary.md the config/simulator call sites still referencing `phi_carryover_mode` for Phase B2 planning.
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:6:input.md:84:- Note which tests or tooling will require deletion or updates during Phase B3 (e.g., tests/test_phi_carryover_mode.py).
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:7:galph_memory.md:808:- Verified docs/bugs/verified_c_bugs.md:166 continues to quarantine C-PARITY-001 as a defect and the PyTorch default path (`Crystal.get_rotated_real_vectors` lines ~1080-1170) keeps `phi_carryover_mode="spec"` as default.
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:8:docs/fix_plan.md:468:    Metrics: Test collection: 35 tests collected successfully in 2.16s (test_cli_scaling_phi0.py + test_phi_carryover_mode.py). Documentation-only loop per input.md Mode: Docs.
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:9:docs/fix_plan.md:572:    Metrics: Targeted tests 35/35 passed in 2.67s (test_cli_scaling_phi0.py + test_phi_carryover_mode.py); core geometry tests 66/66 passed in 8.13s. Trace harness executed successfully (114 TRACE_PY lines captured, pixel 685,1039 final intensity 2.875e-07).
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:10:docs/fix_plan.md:592:    Metrics: Script execution successful; targeted tests 35/35 passed in 2.65s (test_cli_scaling_phi0.py + test_phi_carryover_mode.py). Scaling comparison: first_divergence=I_before_scaling (C: 943654.809, PyTorch: 941686.236, Δrel: -2.086e-03).
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:11:docs/fix_plan.md:637:    Metrics: Evidence-only loop per input.md Do Now directive. Test collection: 35 tests (2 in test_cli_scaling_phi0.py + 33 in test_phi_carryover_mode.py).
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:12:docs/fix_plan.md:647:      - `reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T075949Z/pytest_collect.log` — Test collection logs (test_cli_scaling_phi0.py and test_phi_carryover_mode.py)
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:13:docs/fix_plan.md:901:    Metrics: Test collection: 34 tests collected successfully (tests/test_cli_scaling_phi0.py + tests/test_phi_carryover_mode.py). Evidence-only — no pytest execution this loop.
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:14:docs/fix_plan.md:919:    Metrics: Test collection: 35 tests collected successfully (tests/test_cli_scaling_phi0.py + tests/test_phi_carryover_mode.py). Evidence-only — no pytest execution this loop.
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:15:docs/fix_plan.md:964:      - **Config plumbing**: `CrystalConfig.phi_carryover_mode` field; parser updates in `__main__.py`
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:16:docs/fix_plan.md:980:    Metrics: Targeted tests PASSED (6/6 in 4.25s). Smoke tests: test_cli_scaling_phi0.py 2/2 passed, test_at_geo_001.py 1/1 passed, test_at_crystal_absolute.py 3/3 passed. Config validation: phi_carryover_mode invalid rejection working. No regressions detected.
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:17:docs/fix_plan.md:982:      - `src/nanobrag_torch/config.py:56-59` — Added `phi_carryover_mode: str = "spec"` field to CrystalConfig
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:18:docs/fix_plan.md:993:      - **Default is spec-compliant**: phi_carryover_mode="spec" produces fresh rotations; validates against C-PARITY-001 documentation
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:19:docs/fix_plan.md:1101:    Metrics: Spec mode Δk(φ₀)=1.811649e-02 (expected spec divergence); c-parity max Δk=2.8451466e-05 (>1e-6) and max ΔF_latt_b=4.36e-03 (>1e-4). Targeted pytest `--collect-only` for `tests/test_cli_scaling_phi0.py` and `tests/test_phi_carryover_mode.py` succeeded (699 tests collected).
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:20:docs/fix_plan.md:1214:      - **Spec compliance reconfirmed**: Default `phi_carryover_mode="spec"` behavior correct (specs/spec-a-core.md:211)
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:21:docs/fix_plan.md:2771:      - `reports/2025-10-cli-flags/phase_l/scaling_audit/trace_harness.py:165` — Routed `args.phi_mode` to `crystal_config.phi_carryover_mode`
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:22:docs/fix_plan.md:2772:      - `reports/2025-10-cli-flags/phase_l/scaling_audit/trace_harness.py:202` — Added phi_carryover_mode to config snapshot
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:23:docs/fix_plan.md:3387:        * Call sequence: Initialize cache in Crystal, store φ=final values during `_compute_physics_for_position`, apply carryover when `phi_carryover_mode="c-parity"`
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:24:docs/fix_plan.md:3812:      - Test collection: 35 tests collected successfully in 2.17s (pytest --collect-only -q tests/test_cli_scaling_phi0.py tests/test_phi_carryover_mode.py)
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:25:docs/fix_plan.md:3885:      - `reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/phi_carryover_refs.txt` — Raw grep results for all phi_carryover_mode references
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:26:docs/fix_plan.md:3892:      - **Shim surface area quantified**: 4 production files (`__main__.py`, `config.py`, `crystal.py`, `simulator.py`), 2 test files (`test_phi_carryover_mode.py`, `test_cli_scaling_parity.py`), 3 active plans, and 40+ historical report bundles reference the φ carryover shim
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:27:docs/fix_plan.md:3910:      - **Shim surface area confirmed**: 4 production files (`__main__.py`, `config.py`, `crystal.py`, `simulator.py`), 1 test file to delete (`test_phi_carryover_mode.py`), 1 test file to keep (`test_cli_scaling_phi0.py`)
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:28:docs/fix_plan.md:3918:      - Phase B2: Remove `phi_carryover_mode` field from `config.py` (lines 154, 165-168); delete `apply_phi_carryover()` method from `crystal.py` (lines 245-388); remove c-parity branching from `simulator.py` (line 767)
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:29:docs/fix_plan.md:3919:      - Phase B3: Delete `tests/test_phi_carryover_mode.py`; verify `tests/test_cli_scaling_phi0.py` remains green
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:30:tests/test_phi_carryover_mode.py:39:        """Verify default phi_carryover_mode is 'spec' (spec-compliant)."""
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:31:tests/test_phi_carryover_mode.py:45:        assert args.phi_carryover_mode == 'spec', \
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:32:tests/test_phi_carryover_mode.py:56:        assert args.phi_carryover_mode == 'spec'
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:33:tests/test_phi_carryover_mode.py:66:        assert args.phi_carryover_mode == 'c-parity'
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:34:tests/test_phi_carryover_mode.py:81:    """Test CrystalConfig validation for phi_carryover_mode."""
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:35:tests/test_phi_carryover_mode.py:86:        assert config.phi_carryover_mode == 'spec'
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:36:tests/test_phi_carryover_mode.py:90:        config = CrystalConfig(phi_carryover_mode='spec')
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:37:tests/test_phi_carryover_mode.py:91:        assert config.phi_carryover_mode == 'spec'
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:38:tests/test_phi_carryover_mode.py:95:        config = CrystalConfig(phi_carryover_mode='c-parity')
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:39:tests/test_phi_carryover_mode.py:96:        assert config.phi_carryover_mode == 'c-parity'
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:40:tests/test_phi_carryover_mode.py:100:        with pytest.raises(ValueError, match="phi_carryover_mode must be"):
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:41:tests/test_phi_carryover_mode.py:101:            CrystalConfig(phi_carryover_mode='invalid')
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:42:tests/test_phi_carryover_mode.py:124:        assert args.phi_carryover_mode == 'spec'
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:43:tests/test_phi_carryover_mode.py:130:            phi_carryover_mode=args.phi_carryover_mode
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:44:tests/test_phi_carryover_mode.py:133:        assert crystal_config.phi_carryover_mode == 'spec'
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:45:tests/test_phi_carryover_mode.py:149:        assert args.phi_carryover_mode == 'c-parity'
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:46:tests/test_phi_carryover_mode.py:154:            phi_carryover_mode=args.phi_carryover_mode
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:47:tests/test_phi_carryover_mode.py:157:        assert crystal_config.phi_carryover_mode == 'c-parity'
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:48:tests/test_phi_carryover_mode.py:161:    """Test that phi_carryover_mode affects rotation behavior correctly."""
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:49:tests/test_phi_carryover_mode.py:186:            phi_carryover_mode='spec'
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:50:tests/test_phi_carryover_mode.py:229:            phi_carryover_mode='c-parity'
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:51:tests/test_phi_carryover_mode.py:269:            phi_carryover_mode='spec'
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:52:tests/test_phi_carryover_mode.py:279:            phi_carryover_mode='c-parity'
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:53:tests/test_phi_carryover_mode.py:312:            phi_carryover_mode=mode
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:54:tests/test_phi_carryover_mode.py:334:            phi_carryover_mode=mode
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:55:tests/test_phi_carryover_mode.py:357:            phi_carryover_mode='c-parity'
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:56:tests/test_phi_carryover_mode.py:376:            phi_carryover_mode='c-parity'
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:57:tests/test_phi_carryover_mode.py:393:            phi_carryover_mode='c-parity'
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:58:tests/test_cli_scaling_parity.py:31:        This test validates that when using phi_carryover_mode='c-parity' (which
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:59:tests/test_cli_scaling_parity.py:89:            phi_carryover_mode="c-parity"
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:60:reports/2025-12-cli-flags/phase_l/spec_baseline_refresh/summary.md:32:The tests verify that the default `phi_carryover_mode="spec"` behavior remains correct:
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:61:reports/2025-10-cli-flags/phase_c2/implementation_summary.md:20:phi_carryover_mode: str = "spec"
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:62:reports/2025-10-cli-flags/phase_c2/implementation_summary.md:25:# Validate phi_carryover_mode
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:63:reports/2025-10-cli-flags/phase_c2/implementation_summary.md:26:if self.phi_carryover_mode not in ["spec", "c-parity"]:
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:64:reports/2025-10-cli-flags/phase_c2/implementation_summary.md:28:        f"phi_carryover_mode must be 'spec' or 'c-parity', got '{self.phi_carryover_mode}'"
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:65:reports/2025-10-cli-flags/phase_c2/implementation_summary.md:53:    phi_carryover_mode=args.phi_carryover_mode
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:66:reports/2025-10-cli-flags/phase_c2/implementation_summary.md:57:### 3. `/home/ollie/Documents/tmp/nanoBragg/tests/test_phi_carryover_mode.py`
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:67:reports/2025-10-cli-flags/phase_c2/implementation_summary.md:87:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_default_mode_is_spec PASSED
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:68:reports/2025-10-cli-flags/phase_c2/implementation_summary.md:88:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_spec_mode_explicit PASSED
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:69:reports/2025-10-cli-flags/phase_c2/implementation_summary.md:89:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_c_parity_mode_explicit PASSED
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:70:reports/2025-10-cli-flags/phase_c2/implementation_summary.md:90:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_invalid_mode_rejected PASSED
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:71:reports/2025-10-cli-flags/phase_c2/implementation_summary.md:130:- CrystalConfig field: `phi_carryover_mode` with default "spec"
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:72:reports/2025-10-cli-flags/phase_c2/implementation_summary.md:154:if config.phi_carryover_mode == "c-parity":
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:73:reports/2025-10-cli-flags/phase_c2/implementation_summary.md:202:- Test File: `tests/test_phi_carryover_mode.py`
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:74:reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:26:phi_carryover_mode: str = "spec"
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:75:reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:34:# Validate phi_carryover_mode
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:76:reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:35:if self.phi_carryover_mode not in ["spec", "c-parity"]:
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:77:reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:37:        f"phi_carryover_mode must be 'spec' or 'c-parity', got '{self.phi_carryover_mode}'"
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:78:reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:48:    phi_carryover_mode=args.phi_carryover_mode
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:79:reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:53:**File:** `/home/ollie/Documents/tmp/nanoBragg/tests/test_phi_carryover_mode.py`
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:80:reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:97:KMP_DUPLICATE_LIB_OK=TRUE pytest tests/test_phi_carryover_mode.py -v
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:81:reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:116:**Integration:** Crystal class reads `config.phi_carryover_mode` and applies parity shim when mode="c-parity"
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:82:reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:127:4. **Test File:** `tests/test_phi_carryover_mode.py`
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:83:reports/2025-10-cli-flags/phase_c2/IMPLEMENTATION_CHECKLIST.md:161:3. `tests/test_phi_carryover_mode.py` (new file, 33 tests)
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:84:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:3:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_default_mode_is_spec
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:85:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:4:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_spec_mode_explicit
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:86:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:5:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_c_parity_mode_explicit
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:87:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:6:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_invalid_mode_rejected
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:88:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:7:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_default_config_mode
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:89:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:8:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_spec_mode_validation
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:90:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:9:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_c_parity_mode_validation
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:91:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:10:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_invalid_mode_raises_valueerror
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:92:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:11:tests/test_phi_carryover_mode.py::TestCLIToConfigWiring::test_spec_mode_wiring
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:93:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:12:tests/test_phi_carryover_mode.py::TestCLIToConfigWiring::test_c_parity_mode_wiring
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:94:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:13:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype0]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:95:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:14:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype1]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:96:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:15:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype2]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:97:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:16:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype3]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:98:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:17:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype0]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:99:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:18:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype1]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:100:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:19:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype2]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:101:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:20:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype3]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:102:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:21:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype0]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:103:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:22:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype1]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:104:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:23:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype2]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:105:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:24:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype3]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:106:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:25:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype0-spec]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:107:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:26:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype0-c-parity]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:108:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:27:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype1-spec]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:109:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:28:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype1-c-parity]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:110:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:29:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype0-spec]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:111:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:30:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype0-c-parity]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:112:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:31:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype1-spec]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:113:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:32:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype1-c-parity]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:114:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:33:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_misset
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:115:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:34:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_mosaic
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:116:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T032835Z/pytest_collect.log:35:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_single_phi_step
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:117:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:3:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_default_mode_is_spec
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:118:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:4:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_spec_mode_explicit
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:119:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:5:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_c_parity_mode_explicit
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:120:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:6:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_invalid_mode_rejected
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:121:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:7:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_default_config_mode
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:122:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:8:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_spec_mode_validation
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:123:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:9:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_c_parity_mode_validation
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:124:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:10:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_invalid_mode_raises_valueerror
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:125:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:11:tests/test_phi_carryover_mode.py::TestCLIToConfigWiring::test_spec_mode_wiring
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:126:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:12:tests/test_phi_carryover_mode.py::TestCLIToConfigWiring::test_c_parity_mode_wiring
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:127:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:13:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype0]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:128:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:14:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype1]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:129:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:15:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype2]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:130:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:16:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype3]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:131:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:17:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype0]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:132:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:18:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype1]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:133:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:19:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype2]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:134:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:20:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype3]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:135:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:21:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype0]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:136:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:22:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype1]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:137:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:23:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype2]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:138:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:24:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype3]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:139:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:25:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype0-spec]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:140:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:26:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype0-c-parity]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:141:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:27:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype1-spec]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:142:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:28:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype1-c-parity]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:143:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:29:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype0-spec]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:144:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:30:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype0-c-parity]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:145:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:31:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype1-spec]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:146:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:32:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype1-c-parity]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:147:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:33:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_misset
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:148:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:34:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_mosaic
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:149:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T021659Z/pytest_collect.log:35:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_single_phi_step
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:150:plans/active/phi-carryover-removal/plan.md:8:  - `tests/test_cli_scaling_phi0.py` & `tests/test_phi_carryover_mode.py` — acceptance and regression coverage that will be pruned or reshaped.
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:151:plans/active/phi-carryover-removal/plan.md:21:| A1 | Catalogue shim touchpoints | [X] | List code/tests/docs referencing `phi_carryover_mode` (CLI parser, configs, crystal model, debug harness, docs). Store table in `reports/.../phase_a/baseline_inventory.md` with file paths + rationale. **DONE:** See `reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/baseline_inventory.md` — catalogued 4 production files, 2 test files, 3 plans, 40+ reports. |
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:152:plans/active/phi-carryover-removal/plan.md:28:Exit Criteria: CLI/config/model code no longer exposes `phi_carryover_mode`; default behavior confirmed unchanged via targeted tests; documentation/fix_plan synced with removal artifacts under `reports/.../phase_b/`.
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:153:plans/active/phi-carryover-removal/plan.md:35:| B2 | Prune config/model plumbing | [ ] | Delete `phi_carryover_mode` parameters from `CrystalConfig`/`SimulatorConfig` (if present) and drop `_apply_phi_carryover` branches in `src/nanobrag_torch/models/crystal.py` & `simulator.py`. Ensure vectorised φ rotation path stays intact; reference the nanoBragg.c snippet per CLAUDE Rule #11 when editing docstrings/comments. |
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:154:plans/active/phi-carryover-removal/plan.md:36:| B3 | Retire shim tooling/tests | [ ] | Remove parity-only helpers (e.g., `scripts/compare_per_phi_traces.py` flags) and delete or refactor `tests/test_phi_carryover_mode.py` so only spec-mode assertions remain (migrate reusable checks into `tests/test_cli_scaling_phi0.py`). Update any reports under `reports/2025-10-cli-flags/phase_l/` that the tooling depended on. |
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:155:plans/active/phi-carryover-removal/plan.md:47:| C1 | Update pytest coverage | [ ] | Delete `tests/test_phi_carryover_mode.py`; fold any remaining spec assertions into `tests/test_cli_scaling_phi0.py`. Validate selectors via `pytest --collect-only -q tests/test_cli_scaling_phi0.py`. |
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:156:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:3:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_default_mode_is_spec
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:157:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:4:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_spec_mode_explicit
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:158:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:5:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_c_parity_mode_explicit
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:159:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:6:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_invalid_mode_rejected
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:160:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:7:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_default_config_mode
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:161:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:8:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_spec_mode_validation
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:162:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:9:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_c_parity_mode_validation
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:163:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:10:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_invalid_mode_raises_valueerror
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:164:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:11:tests/test_phi_carryover_mode.py::TestCLIToConfigWiring::test_spec_mode_wiring
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:165:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:12:tests/test_phi_carryover_mode.py::TestCLIToConfigWiring::test_c_parity_mode_wiring
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:166:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:13:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype0]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:167:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:14:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype1]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:168:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:15:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype2]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:169:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:16:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype3]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:170:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:17:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype0]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:171:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:18:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype1]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:172:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:19:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype2]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:173:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:20:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype3]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:174:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:21:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype0]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:175:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:22:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype1]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:176:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:23:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype2]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:177:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:24:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype3]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:178:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:25:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype0-spec]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:179:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:26:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype0-c-parity]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:180:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:27:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype1-spec]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:181:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:28:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype1-c-parity]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:182:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:29:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype0-spec]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:183:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:30:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype0-c-parity]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:184:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:31:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype1-spec]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:185:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:32:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype1-c-parity]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:186:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:33:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_misset
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:187:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:34:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_mosaic
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:188:reports/2025-10-cli-flags/phase_l/parity_shim/pytest_collect.log:35:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_single_phi_step
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:189:plans/active/cli-phi-parity-shim/plan.md:35:| B2 | Choose API & config plumbing | [D] | ✅ Documented in `design.md` §2-3: CLI flag `--phi-carryover-mode`, `CrystalConfig.phi_carryover_mode` field (default="spec"), parser updates in `__main__.py`. Unambiguous naming; no flag collision. |
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:190:plans/active/cli-phi-parity-shim/plan.md:46:| C2 | Update CLI / configs | [D] | ✅ CLI flag `--phi-carryover-mode {spec,c-parity}` and `CrystalConfig.phi_carryover_mode` field landed (`src/nanobrag_torch/__main__.py:377-386`, `config.py:154-171`); validation rejects invalid modes (Attempt #120). |
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:191:plans/active/cli-phi-parity-shim/plan.md:47:| C3 | Add regression & parity tests | [D] | ✅ `tests/test_phi_carryover_mode.py` exercises parsing, config wiring, and device/dtype behavior for both modes; `tests/test_cli_scaling_phi0.py` still enforces spec baselines (documented in docs/fix_plan.md Attempt #120). |
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:192:reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/commands.txt:10:# Command 2: Search for phi_carryover_mode references across codebase
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:193:reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/commands.txt:12:rg -n "phi_carryover_mode"
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:194:reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/baseline_inventory.md:10:This document catalogues all references to the `phi_carryover_mode` shim introduced during CLI-FLAGS-003 to replicate C-PARITY-001 (documented in `docs/bugs/verified_c_bugs.md:166-204`). The shim allows opt-in emulation of the C-code bug where φ=0 pixels reuse the previous pixel's final φ rotation state instead of computing fresh rotations per spec (`specs/spec-a-core.md:204-240`).
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:195:reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/baseline_inventory.md:17:- **Line 859:** CLI argument passed to `CrystalConfig(phi_carryover_mode=args.phi_carryover_mode)`
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:196:reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/baseline_inventory.md:24:- **Default:** `phi_carryover_mode: str = "spec"`
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:197:reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/baseline_inventory.md:32:- **Line 1482-1484:** Conditional logic `if config.phi_carryover_mode == "c-parity" and self._phi_cache_initialized:`
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:198:reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/baseline_inventory.md:38:- **Reference:** Passes `config.phi_carryover_mode` implicitly via CrystalConfig
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:199:reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/baseline_inventory.md:45:### tests/test_phi_carryover_mode.py
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:200:reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/baseline_inventory.md:142:- **Risk:** Deleting `test_phi_carryover_mode.py` may drop edge-case coverage
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:201:reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/phi_carryover_refs.txt:1:# phi_carryover_mode References (50+ files)
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:202:reports/2025-10-cli-flags/phase_phi_removal/phase_a/20251008T184422Z/phi_carryover_refs.txt:13:tests/test_phi_carryover_mode.py
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:203:reports/2025-10-cli-flags/phase_l/parity_shim/20251201_dtype_probe/analysis_summary.md:88:- Modify `src/nanobrag_torch/models/crystal.py` to force `dtype=torch.float64` when `phi_carryover_mode == 'c-parity'`
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:204:reports/2025-10-cli-flags/phase_l/parity_shim/20251201_dtype_probe/analysis_summary.md:107:3. Ensure `tests/test_phi_carryover_mode.py` documents the relaxed tolerance for c-parity
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:205:reports/2025-10-cli-flags/phase_l/rot_vector/trace_harness.py:145:    # Inject phi_carryover_mode from --phi-mode flag (Phase L3k.3c.4)
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:206:reports/2025-10-cli-flags/phase_l/rot_vector/trace_harness.py:146:    params['crystal']['phi_carryover_mode'] = args.phi_mode
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:207:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:8:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype0] PASSED [  8%]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:208:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:9:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype1] PASSED [ 16%]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:209:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:10:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype2] PASSED [ 25%]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:210:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:11:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype3] PASSED [ 33%]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:211:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:12:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype0] PASSED [ 41%]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:212:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:13:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype1] PASSED [ 50%]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:213:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:14:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype2] PASSED [ 58%]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:214:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:15:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype3] PASSED [ 66%]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:215:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:16:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype0] PASSED [ 75%]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:216:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:17:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype1] PASSED [ 83%]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:217:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:18:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype2] PASSED [ 91%]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:218:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/pytest_phi_carryover.log:19:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype3] PASSED [100%]
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:219:reports/2025-10-cli-flags/phase_phi_removal/phase_b/README.md:18:- [ ] Confirm `CrystalConfig.phi_carryover_mode` field can be safely deleted
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:220:reports/2025-10-cli-flags/phase_phi_removal/phase_b/README.md:44:- [ ] No references to `phi_carryover_mode` in production code
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:221:reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/env.json:22:  "notes": "Design-only loop. No code changes. Establishes removal plan for phi_carryover_mode shim."
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:222:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:123:    phi_carryover_mode: str = "spec"  # "spec" | "c-parity"
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:223:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:126:        if self.phi_carryover_mode not in ("spec", "c-parity"):
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:224:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:128:                f"phi_carryover_mode must be 'spec' or 'c-parity', "
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:225:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:129:                f"got {self.phi_carryover_mode!r}"
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:226:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:156:        phi_carryover_mode=args.phi_carryover_mode,
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:227:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:169:│   → CrystalConfig(phi_carryover_mode="c-parity")            │
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:228:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:174:│   → self.phi_carryover_mode = config.phi_carryover_mode     │
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:229:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:179:│   if config.phi_carryover_mode == "c-parity":               │
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:230:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:240:        config: CrystalConfig with phi_carryover_mode setting
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:231:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:247:    if config.phi_carryover_mode == "c-parity":
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:232:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:359:        # Setup: config with phi_carryover_mode="c-parity"
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:233:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:375:        # Setup: config with phi_carryover_mode="spec" (default)
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:234:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:395:def test_phi_carryover_mode_parsing():
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:235:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:401:    assert args.phi_carryover_mode == "spec"
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:236:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:405:    assert args.phi_carryover_mode == "spec"
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:237:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:409:    assert args.phi_carryover_mode == "c-parity"
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:238:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:524:    phi_carryover_mode="c-parity"  # Opt-in parity mode
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:239:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:531:**Default behavior** (`phi_carryover_mode="spec"`) remains spec-compliant with identity rotation at φ=0°.
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:240:reports/2025-10-cli-flags/phase_l/parity_shim/20251007T232657Z/design.md:572:- [ ] `CrystalConfig.phi_carryover_mode` field added with validation
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:241:reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/commands.txt:10:# Step 3: Search for phi_carryover_mode references
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:242:reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/commands.txt:11:grep -r "phi_carryover_mode\|phi-carryover-mode" --include="*.py" --include="*.md" . | grep -v ".git" > /tmp/phi_refs.txt
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:243:reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/commands.txt:15:grep -n -C 3 "phi_carryover_mode\|phi-carryover-mode" src/nanobrag_torch/__main__.py
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:244:reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/commands.txt:16:grep -n -C 3 "phi_carryover_mode" src/nanobrag_torch/config.py
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:245:reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/commands.txt:26:# - Phase B2: Remove phi_carryover_mode from config.py, crystal.py, simulator.py
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:246:reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/commands.txt:27:# - Phase B3: Delete tests/test_phi_carryover_mode.py
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:247:reports/2025-10-cli-flags/phase_l/parity_shim/20251008T012304Z/delta_metrics.json:34:    "test_phi_carryover_mode": "12/12 PASSED",
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:248:src/nanobrag_torch/models/crystal.py:1463:            config: CrystalConfig containing rotation parameters and phi_carryover_mode
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:249:src/nanobrag_torch/models/crystal.py:1482:        if config.phi_carryover_mode == "c-parity" and self._phi_cache_initialized:
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:250:reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/design_review.md:46:- Remove `phi_carryover_mode=args.phi_carryover_mode` assignment to CrystalConfig
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:251:reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/design_review.md:53:- Remove `phi_carryover_mode: str = "spec"` field from CrystalConfig
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:252:reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/design_review.md:74:- Remove conditional check `if self.crystal.config.phi_carryover_mode == "c-parity":`
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:253:reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/design_review.md:81:#### 5. `tests/test_phi_carryover_mode.py`
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:254:reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/design_review.md:164:5. ✅ No references to `phi_carryover_mode` in production code (grep verification)
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:255:reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/design_review.md:189:3. **B3: Tests/tooling** — Delete `test_phi_carryover_mode.py`, update validation scripts
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:256:reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/design_review.md:217:- Deliverable: No `phi_carryover_mode` parameters or branching logic
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:257:reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T185921Z/design_review.md:220:- Files: `tests/test_phi_carryover_mode.py` (delete)
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:258:src/nanobrag_torch/config.py:154:    phi_carryover_mode: str = "spec"
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:259:src/nanobrag_torch/config.py:164:        # Validate phi_carryover_mode
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:260:src/nanobrag_torch/config.py:165:        if self.phi_carryover_mode not in ["spec", "c-parity"]:
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:261:src/nanobrag_torch/config.py:167:                f"phi_carryover_mode must be 'spec' or 'c-parity', got '{self.phi_carryover_mode}'"
reports/2025-10-cli-flags/phase_phi_removal/phase_b/20251008T191302Z/grep.log:262:src/nanobrag_torch/simulator.py:767:        if self.crystal.config.phi_carryover_mode == "c-parity":
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T011326Z/summary.md:4:- Re-ran `trace_harness.py` for supervisor configuration at pixel (685, 1039) with `phi_carryover_mode` set to `spec` and `c-parity`.
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/commands.txt:7:pytest --collect-only -q tests/test_cli_scaling_phi0.py tests/test_phi_carryover_mode.py
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:3:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_default_mode_is_spec
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:4:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_spec_mode_explicit
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:5:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_c_parity_mode_explicit
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:6:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_invalid_mode_rejected
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:7:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_default_config_mode
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:8:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_spec_mode_validation
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:9:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_c_parity_mode_validation
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:10:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_invalid_mode_raises_valueerror
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:11:tests/test_phi_carryover_mode.py::TestCLIToConfigWiring::test_spec_mode_wiring
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:12:tests/test_phi_carryover_mode.py::TestCLIToConfigWiring::test_c_parity_mode_wiring
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:13:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype0]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:14:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype1]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:15:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype2]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:16:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype3]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:17:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype0]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:18:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype1]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:19:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype2]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:20:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype3]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:21:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype0]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:22:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype1]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:23:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype2]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:24:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype3]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:25:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype0-spec]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:26:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype0-c-parity]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:27:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype1-spec]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:28:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype1-c-parity]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:29:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype0-spec]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:30:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype0-c-parity]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:31:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype1-spec]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:32:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype1-c-parity]
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:33:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_misset
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:34:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_mosaic
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/collect.log:35:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_single_phi_step
reports/2025-10-cli-flags/phase_l/scaling_audit/trace_harness.py:167:        phi_carryover_mode=args.phi_mode,  # Phase M1: route supervisor override
reports/2025-10-cli-flags/phase_l/scaling_audit/trace_harness.py:204:            'phi_carryover_mode': crystal_config.phi_carryover_mode
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:592:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_default_mode_is_spec
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:593:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_spec_mode_explicit
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:594:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_c_parity_mode_explicit
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:595:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_invalid_mode_rejected
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:596:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_default_config_mode
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:597:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_spec_mode_validation
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:598:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_c_parity_mode_validation
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:599:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_invalid_mode_raises_valueerror
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:600:tests/test_phi_carryover_mode.py::TestCLIToConfigWiring::test_spec_mode_wiring
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:601:tests/test_phi_carryover_mode.py::TestCLIToConfigWiring::test_c_parity_mode_wiring
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:602:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype0]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:603:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype1]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:604:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype2]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:605:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype3]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:606:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype0]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:607:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype1]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:608:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype2]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:609:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype3]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:610:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype0]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:611:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype1]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:612:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype2]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:613:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype3]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:614:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype0-spec]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:615:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype0-c-parity]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:616:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype1-spec]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:617:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype1-c-parity]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:618:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype0-spec]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:619:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype0-c-parity]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:620:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype1-spec]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:621:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype1-c-parity]
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:622:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_misset
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:623:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_mosaic
reports/2025-10-cli-flags/phase_l/rot_vector/20251202_tolerance_sync/collect_only.log:624:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_single_phi_step
reports/2025-10-cli-flags/phase_l/rot_vector/20251007T212159Z/summary.md:35:**Command**: `KMP_DUPLICATE_LIB_OK=TRUE pytest --collect-only -q tests/test_cli_scaling_phi0.py tests/test_phi_carryover_mode.py`
reports/2025-10-cli-flags/phase_l/scaling_audit/config_snapshot.json:18:    "phi_carryover_mode": "c-parity"
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T013345Z/pytest_phi_carryover.log:8:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype0] PASSED [  8%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T013345Z/pytest_phi_carryover.log:9:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype1] PASSED [ 16%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T013345Z/pytest_phi_carryover.log:10:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype2] PASSED [ 25%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T013345Z/pytest_phi_carryover.log:11:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype3] PASSED [ 33%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T013345Z/pytest_phi_carryover.log:12:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype0] PASSED [ 41%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T013345Z/pytest_phi_carryover.log:13:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype1] PASSED [ 50%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T013345Z/pytest_phi_carryover.log:14:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype2] PASSED [ 58%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T013345Z/pytest_phi_carryover.log:15:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype3] PASSED [ 66%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T013345Z/pytest_phi_carryover.log:16:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype0] PASSED [ 75%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T013345Z/pytest_phi_carryover.log:17:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype1] PASSED [ 83%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T013345Z/pytest_phi_carryover.log:18:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype2] PASSED [ 91%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T013345Z/pytest_phi_carryover.log:19:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype3] PASSED [100%]
reports/2025-10-cli-flags/phase_l/parity_shim/20251008T013345Z/summary.md:37:### test_phi_carryover_mode.py::TestPhiCarryoverBehavior
reports/2025-10-cli-flags/phase_l/scaling_validation/20251208_option1_refresh/analysis.md:32:**Implication for parity shim:** The opt-in `phi_carryover_mode="c-parity"` reproduces the bug to match golden C data, but `mode="spec"` (default) follows the quoted normative contract.
reports/2025-10-cli-flags/phase_l/scaling_validation/20251208_option1_refresh/analysis.md:96:          ├─ if phi_carryover_mode == "c-parity":
reports/2025-10-cli-flags/phase_l/scaling_validation/20251208_option1_refresh/analysis.md:145:    if phi_carryover_mode == "c-parity" and cache_valid[s,f]:
reports/2025-10-cli-flags/phase_l/scaling_validation/20251208_option1_refresh/analysis.md:213:**Interpretation:** The spec requires fresh rotation from (a0,b0,c0) every step — no mention of carryover. PyTorch default (`phi_carryover_mode="spec"`) implements this contract exactly. The c-parity shim reproduces the C bug for golden data matching only.
reports/2025-10-cli-flags/phase_l/scaling_validation/20251208_option1_refresh/analysis.md:307:- `tests/test_phi_carryover_mode.py` — Dual-mode validation tests
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:592:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_default_mode_is_spec
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:593:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_spec_mode_explicit
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:594:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_c_parity_mode_explicit
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:595:tests/test_phi_carryover_mode.py::TestPhiCarryoverModeParsing::test_invalid_mode_rejected
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:596:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_default_config_mode
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:597:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_spec_mode_validation
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:598:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_c_parity_mode_validation
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:599:tests/test_phi_carryover_mode.py::TestCrystalConfigValidation::test_invalid_mode_raises_valueerror
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:600:tests/test_phi_carryover_mode.py::TestCLIToConfigWiring::test_spec_mode_wiring
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:601:tests/test_phi_carryover_mode.py::TestCLIToConfigWiring::test_c_parity_mode_wiring
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:602:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype0]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:603:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cpu-dtype1]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:604:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype2]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:605:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_spec_mode_fresh_rotation[cuda-dtype3]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:606:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype0]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:607:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cpu-dtype1]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:608:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype2]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:609:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_c_parity_mode_stale_carryover[cuda-dtype3]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:610:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype0]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:611:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cpu-dtype1]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:612:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype2]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:613:tests/test_phi_carryover_mode.py::TestPhiCarryoverBehavior::test_modes_differ_at_phi_zero[cuda-dtype3]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:614:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype0-spec]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:615:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype0-c-parity]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:616:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype1-spec]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:617:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cpu_consistency[dtype1-c-parity]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:618:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype0-spec]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:619:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype0-c-parity]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:620:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype1-spec]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:621:tests/test_phi_carryover_mode.py::TestDeviceDtypeNeutrality::test_cuda_consistency[dtype1-c-parity]
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:622:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_misset
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:623:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_mosaic
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T043438Z/collect_only.log:624:tests/test_phi_carryover_mode.py::TestFlagInteractions::test_with_single_phi_step
reports/2025-10-cli-flags/phase_l/scaling_validation/20251208_option1_refresh/commands.txt:36:#    KMP_DUPLICATE_LIB_OK=TRUE pytest -xvs tests/test_phi_carryover_mode.py
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T060721Z/config_snapshot.json:18:    "phi_carryover_mode": "c-parity"
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T072513Z/validation_report.md:38:pytest tests/test_cli_scaling_phi0.py tests/test_phi_carryover_mode.py
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T165745Z_carryover_cache_validation/gradcheck_probe.py:55:        phi_carryover_mode="c-parity",  # Enable carryover cache
reports/2025-10-cli-flags/phase_l/scaling_validation/phi_carryover_diagnosis.md:69:if config.phi_carryover_mode == "c-parity":
reports/2025-10-cli-flags/phase_l/scaling_validation/phi_carryover_diagnosis.md:124:if config.phi_carryover_mode == "c-parity":
reports/2025-10-cli-flags/phase_l/scaling_validation/phi_carryover_diagnosis.md:136:if config.phi_carryover_mode == "c-parity":
reports/2025-10-cli-flags/phase_l/scaling_validation/phi_carryover_diagnosis.md:145:if phi_tic == 0 and config.phi_carryover_mode == "c-parity":
reports/2025-10-cli-flags/phase_l/scaling_validation/phi_carryover_diagnosis.md:150:    if phi_tic == 0 and config.phi_carryover_mode == "c-parity":
reports/2025-10-cli-flags/phase_l/scaling_validation/phi_carryover_diagnosis.md:182:          ├─ if phi_carryover_mode == "c-parity":
reports/2025-10-cli-flags/phase_l/scaling_validation/phi_carryover_diagnosis.md:229:    config = CrystalConfig(cell_a=cell_a, phi_carryover_mode="c-parity")
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T145905Z/m2g_blocker/analysis.md:31:if self.crystal.config.phi_carryover_mode == "c-parity":
reports/2025-10-cli-flags/phase_l/scaling_validation/20251210_optionB_design/optionB_batch_design.md:58:**Interpretation:** Spec requires **fresh rotation from (a0,b0,c0) every φ step** — no accumulation or carryover. PyTorch default (`phi_carryover_mode="spec"`) follows this contract exactly. The c-parity shim reproduces the C bug for golden data matching only.
reports/2025-10-cli-flags/phase_l/scaling_validation/20251210_optionB_design/optionB_batch_design.md:154:    φ=0 substitution when phi_carryover_mode="c-parity".
reports/2025-10-cli-flags/phase_l/scaling_validation/20251210_optionB_design/optionB_batch_design.md:168:        config: Crystal configuration with phi_carryover_mode
reports/2025-10-cli-flags/phase_l/scaling_validation/20251210_optionB_design/optionB_batch_design.md:183:    if config.phi_carryover_mode == "c-parity":
reports/2025-10-cli-flags/phase_l/scaling_validation/20251210_optionB_design/optionB_batch_design.md:242:4. **Spec mode unaffected:** When `phi_carryover_mode="spec"`, cache lookup/store skipped entirely
reports/2025-10-cli-flags/phase_l/scaling_validation/20251210_optionB_design/optionB_batch_design.md:382:        phi_carryover_mode="c-parity", ...
reports/2025-10-cli-flags/phase_l/scaling_validation/20251210_optionB_design/optionB_batch_design.md:452:**Critical requirement:** Default behavior (`phi_carryover_mode="spec"`) **MUST NOT** be affected by Option B implementation.
reports/2025-10-cli-flags/phase_l/scaling_validation/20251210_optionB_design/optionB_batch_design.md:458:    if config.phi_carryover_mode != "c-parity":
reports/2025-10-cli-flags/phase_l/scaling_validation/20251210_optionB_design/optionB_batch_design.md:473:- Validate that cache is never allocated when `phi_carryover_mode="spec"`
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T153142Z_carryover_cache_plumbing/pytest.log:11:        This test validates that when using phi_carryover_mode='c-parity' (which
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T153142Z_carryover_cache_plumbing/pytest.log:69:            phi_carryover_mode="c-parity"
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T153142Z_carryover_cache_plumbing/pytest.log:200:        if self.crystal.config.phi_carryover_mode == "c-parity":
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T153142Z_carryover_cache_plumbing/pytest.log:458:            use_row_batching = (self.crystal.config.phi_carryover_mode == "c-parity"
reports/2025-10-cli-flags/phase_l/scaling_validation/20251210_optionB_design/prototype.md:265:- Apply c-parity substitution only when `config.phi_carryover_mode=="c-parity"`
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T075949Z/commands.txt:13:PYTHONPATH=src pytest --collect-only tests/test_phi_carryover_mode.py >> reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T075949Z/pytest_collect.log
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T102155Z/parity_test_failure/pytest.log:19:        This test validates that when using phi_carryover_mode='c-parity' (which
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T102155Z/parity_test_failure/pytest.log:77:            phi_carryover_mode="c-parity"
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T075949Z/pytest_collect.log:33:    <Module test_phi_carryover_mode.py>
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T153142Z_carryover_cache_plumbing/pytest_run2.log:11:        This test validates that when using phi_carryover_mode='c-parity' (which
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T153142Z_carryover_cache_plumbing/pytest_run2.log:69:            phi_carryover_mode="c-parity"
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T160802Z_carryover_cache_validation/diagnostics.md:61:    if φ_tic == 0 and phi_carryover_mode == "c-parity":
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T160802Z_carryover_cache_validation/diagnostics.md:126:    phi_carryover_mode="c-parity",
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T070513Z/instrumentation_audit.md:54:pytest -xvs tests/test_cli_scaling_phi0.py tests/test_phi_carryover_mode.py
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T070513Z/instrumentation_audit.md:63:KMP_DUPLICATE_LIB_OK=TRUE pytest -xvs tests/test_cli_scaling_phi0.py tests/test_phi_carryover_mode.py
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T070513Z/instrumentation_audit.md:70:- `test_phi_carryover_mode.py` (33 tests) — CLI parsing, config validation, device/dtype neutrality (CPU + CUDA, float32 + float64)
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T160802Z_carryover_cache_validation/pytest_cpu.log:11:        This test validates that when using phi_carryover_mode='c-parity' (which
reports/2025-10-cli-flags/phase_l/scaling_validation/20251008T160802Z_carryover_cache_validation/pytest_cpu.log:69:            phi_carryover_mode="c-parity"
