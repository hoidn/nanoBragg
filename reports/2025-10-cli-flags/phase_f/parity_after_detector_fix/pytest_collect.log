============================= test session starts ==============================
platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0
rootdir: /home/ollie/Documents/tmp/nanoBragg
configfile: pyproject.toml
testpaths: tests
collected 624 items / 1 skipped

<Dir nanoBragg>
  <Package tests>
    <Module test_at_abs_001.py>
      <Class TestAT_ABS_001>
        <Function test_absorption_disabled_when_zero>
        <Function test_capture_fraction_calculation>
        <Function test_last_value_vs_accumulation_semantics>
        <Function test_parallax_dependence>
        <Function test_absorption_with_tilted_detector>
    <Module test_at_bkg_001.py>
      <Class TestAT_BKG_001>
        <Function test_water_background_calculation>
        <Function test_water_background_zero>
        <Function test_water_background_additive>
    <Module test_at_cli_001.py>
      <Class TestAT_CLI_001>
        <Function test_cli_help_short_flag>
        <Function test_cli_help_long_flag>
        <Function test_cli_invocable>
        <Function test_cli_help_includes_examples>
        <Function test_cli_help_includes_wavelength_synonyms>
        <Function test_cli_help_includes_output_synonyms>
    <Module test_at_cli_002.py>
      <Class TestAT_CLI_002>
        <Function test_minimal_render_with_default_F>
        <Function test_minimal_render_with_hkl_file>
        <Function test_data_ordering_fast_major>
        <Function test_error_without_required_inputs>
    <Module test_at_cli_003.py>
      <Class TestATCLI003>
        <Function test_mosflm_default_pivot_beam>
        <Function test_xds_default_pivot_sample>
        <Function test_pivot_override_mosflm_to_sample>
        <Function test_pivot_override_xds_to_beam>
        <Function test_convention_header_keys_consistency>
    <Module test_at_cli_004.py>
      <Function test_header_precedence_img_then_mask>
      <Function test_mask_zeros_are_skipped>
      <Function test_mask_beam_center_y_flip>
      <Function test_conflicting_detector_size>
      <Function test_img_only_no_mask>
    <Module test_at_cli_005.py>
      <Function test_cli_roi_basic>
      <Function test_cli_roi_with_noise>
      <Function test_cli_roi_edge_cases>
      <Function test_cli_roi_different_conventions>
    <Module test_at_cli_006.py>
      <Function test_autoscale_without_scale_flag>
      <Function test_explicit_scale_flag>
      <Function test_pgm_without_pgmscale>
      <Function test_pgm_with_explicit_pgmscale>
      <Function test_pgm_format_compliance>
    <Module test_at_cli_007.py>
      <Class TestATCLI007NoiseDeterminism>
        <Function test_identical_seed_produces_identical_noise>
        <Function test_different_seed_produces_different_noise>
        <Function test_seed_determinism_without_roi>
        <Function test_negative_seed_accepted>
        <Function test_overload_count_determinism>
    <Module test_at_cli_008.py>
      <Class TestATCLI008DminFiltering>
        <Function test_dmin_filtering_reduces_intensity>
        <Function test_dmin_very_strict_removes_most_intensity>
        <Function test_dmin_zero_has_no_effect>
    <Module test_at_cli_009.py>
      <Class TestATCLI009ErrorHandling>
        <Function test_missing_hkl_and_fdump_with_default_f_zero>
        <Function test_missing_hkl_but_has_default_f>
        <Function test_missing_cell_parameters>
        <Function test_fdump_fallback>
        <Function test_help_message>
        <Function test_unsupported_flag_dispstep>
        <Function test_unsupported_flag_hdiv>
        <Function test_unsupported_flag_vdiv>
    <Module test_at_crystal_absolute.py>
      <Class TestATCrystalAbsolute>
        <Function test_triclinic_absolute_positions>
        <Function test_cubic_vs_triclinic_systematic_difference>
        <Function test_known_reflection_d_spacings>
    <Module test_at_flu_001.py>
      <Class TestAT_FLU_001>
        <Function test_fluence_calculation_from_flux_exposure_beamsize>
        <Function test_no_fluence_calculation_when_flux_zero>
        <Function test_no_fluence_calculation_when_exposure_zero>
        <Function test_fluence_calculation_with_beamsize_zero>
        <Function test_flux_recomputation_from_fluence_and_exposure>
        <Function test_sample_clipping_warning>
        <Function test_no_clipping_when_beamsize_larger>
        <Function test_no_clipping_when_beamsize_zero>
    <Module test_at_geo_001.py>
      <Function test_at_geo_001_mosflm_beam_center_mapping>
    <Module test_at_geo_002.py>
      <Function test_at_geo_002_setup_a_distance_only>
      <Function test_at_geo_002_setup_b_close_distance_only>
      <Function test_at_geo_002_setup_c_explicit_override>
      <Function test_at_geo_002_setup_c_beam_override>
      <Function test_at_geo_002_direct_instantiation>
    <Module test_at_geo_003.py>
      <Class TestATGEO003RFactorAndBeamCenter>
        <Function test_r_factor_calculation>
        <Function test_distance_update_with_close_distance>
        <Function test_beam_center_preservation_beam_pivot>
        <Function test_beam_center_preservation_sample_pivot>
        <Function test_no_rotations_r_factor_equals_one>
        <Function test_beam_center_with_various_rotations[DetectorPivot.BEAM]>
        <Function test_beam_center_with_various_rotations[DetectorPivot.SAMPLE]>
        <Function test_gradients_flow_through_r_factor>
    <Module test_at_geo_004.py>
      <Function test_twotheta_axis_defaults>
      <Function test_twotheta_axis_override>
      <Function test_twotheta_rotation_applied>
      <Function test_twotheta_value_preserved>
      <Function test_mosflm_twotheta_rotation>
      <Function test_dials_twotheta_rotation>
    <Module test_at_geo_005.py>
      <Class TestATGEO005CurvedDetector>
        <Function test_curved_detector_equal_distance>
        <Function test_curved_vs_planar_difference>
        <Function test_small_angle_rotation_consistency>
        <Function test_gradient_flow_curved_detector>
        <Function test_beam_center_affects_curvature>
    <Module test_at_geo_006.py>
      <Class TestATGEO006PointPixelSolidAngle>
        <Function test_point_pixel_solid_angle>
        <Function test_default_solid_angle_with_obliquity>
        <Function test_off_center_pixel_comparison>
        <Function test_gradient_flow>
        <Function test_corner_pixel_values>
    <Module test_at_io_001.py>
      <Class TestAT_IO_001>
        <Function test_smv_header_required_keys>
        <Function test_smv_data_ordering>
        <Function test_smv_convention_specific_headers>
        <Function test_smv_torch_tensor_input>
        <Function test_smv_byte_order>
    <Module test_at_io_002.py>
      <Class TestAT_IO_002>
        <Function test_pgm_header_format>
        <Function test_pgm_pixel_scaling>
        <Function test_pgm_with_default_scale>
        <Function test_pgm_torch_tensor_input>
        <Function test_pgm_clipping_behavior>
    <Module test_at_io_003.py>
      <Class TestAT_IO_003>
        <Function test_fdump_write_and_read>
        <Function test_fdump_cache_behavior>
        <Function test_fdump_no_files_with_default_F>
        <Function test_fdump_no_files_zero_default>
        <Function test_fdump_preserves_default_F>
        <Function test_fdump_header_structure>
    <Module test_at_io_004.py>
      <Class TestAT_IO_004>
        <Function test_minimal_hkl_format>
        <Function test_five_column_with_phase>
        <Function test_six_column_with_sigma_and_phase>
        <Function test_negative_indices_handling>
        <Function test_all_formats_produce_same_pattern>
        <Function test_fdump_caching_for_all_formats>
        <Function test_comment_and_blank_line_handling>
    <Module test_at_noise_001.py>
      <Class TestATNoise001>
        <Function test_small_mean_exact_poisson>
        <Function test_medium_mean_rejection_sampling>
        <Function test_large_mean_gaussian_approximation>
        <Function test_seed_reproducibility>
        <Function test_adc_and_clipping>
        <Function test_all_regimes_in_single_image>
        <Function test_noise_config_integration>
    <Module test_at_parallel_001.py>
      <Class TestATParallel001>
        <Function test_beam_center_scales_with_detector_size[64]>
        <Function test_beam_center_scales_with_detector_size[128]>
        <Function test_beam_center_scales_with_detector_size[256]>
        <Function test_beam_center_scales_with_detector_size[512]>
        <Function test_beam_center_scales_with_detector_size[1024]>
        <Function test_peak_position_at_beam_center>
        <Function test_cli_beam_center_calculation>
        <Function test_intensity_scaling_with_solid_angle>
    <Module test_at_parallel_002.py>
      <Class TestATParallel002>
        <Function test_beam_center_scales_with_pixel_size>
        <Function test_peak_position_scales_inversely_with_pixel_size>
        <Function test_pattern_correlation_across_pixel_sizes>
        <Function test_beam_center_parameter_consistency>
    <Module test_at_parallel_003.py>
      <Class TestATParallel003>
        <Function test_detector_offset_preservation>
        <Function test_peak_position_at_offset_beam_centers>
        <Function test_offset_ratio_preservation>
    <Module test_at_parallel_004.py>
      <Class TestAT_PARALLEL_004>
        <Function test_mosflm_adds_half_pixel_offset>
        <Function test_xds_has_no_pixel_offset>
        <Function test_peak_position_difference>
        <Function test_pattern_correlation_when_aligned>
        <Function test_beam_center_calculation_consistency>
    <Module test_at_parallel_005.py>
      <Class TestAT_PARALLEL_005_BeamCenterMapping>
        <Function test_mosflm_xbeam_ybeam_mapping>
        <Function test_xds_orgx_orgy_mapping>
        <Function test_pivot_mode_consistency>
        <Function test_equivalent_configurations_produce_same_pattern>
    <Module test_at_parallel_006.py>
      <Class TestATParallel006SingleReflection>
        <Function test_bragg_angle_prediction_single_distance>
        <Function test_distance_scaling>
        <Function test_combined_wavelength_and_distance>
    <Module test_at_parallel_007.py>
      <Class TestATParallel007PeakPositionWithRotations>
        <Function test_peak_positions_with_rotations>
        <Function test_peak_intensity_ordering>
        <Function test_rotation_effect_on_pattern>
    <Module test_at_parallel_008.py>
      <Class TestAT_PARALLEL_008>
        <Function test_triclinic_multi_peak_pattern>
        <Function test_peak_intensity_ordering>
        <Function test_non_max_suppression>
    <Module test_at_parallel_010.py>
      <Class TestATParallel010SolidAngleCorrections>
        <Function test_point_pixel_distance_scaling>
        <Function test_obliquity_distance_scaling>
        <Function test_obliquity_with_tilts>
        <Function test_combined_distance_and_tilt>
    <Module test_at_parallel_011.py>
      <Class TestATParallel011PolarizationFactor>
        <Function test_unpolarized_theory>
        <Function test_polarized_kahn_model>
        <Function test_c_pytorch_equivalence>
    <Module test_at_parallel_012.py>
      <Class TestATParallel012ReferencePatternCorrelation>
        <Function test_simple_cubic_correlation>
        <Function test_triclinic_P1_correlation>
        <Function test_cubic_tilted_detector_correlation>
        <Function test_high_resolution_variant>
    <Module test_at_parallel_013.py>
      <Class TestATParallel013CrossPlatformConsistency>
        <Function test_pytorch_determinism_same_seed>
        <Function test_pytorch_determinism_different_seeds>
        <Function test_pytorch_consistency_across_runs>
        <Function test_c_pytorch_equivalence>
        <Function test_platform_fingerprint>
        <Function test_numerical_precision_float64>
    <Module test_at_parallel_014.py>
      <Class TestATParallel014NoiseRobustness>
        <Function test_mean_preservation_after_scaling>
        <Function test_peak_centroid_stability>
        <Function test_overload_count_consistency>
        <Function test_noise_statistics>
        <Function test_deterministic_noise_with_seed>
    <Module test_at_parallel_015.py>
      <Class TestATParallel015MixedUnits>
        <Function test_distance_units_consistency>
        <Function test_wavelength_units_consistency>
        <Function test_angle_units_consistency>
        <Function test_mixed_units_comprehensive>
        <Function test_detector_rotation_units>
    <Module test_at_parallel_016.py>
      <Class TestATParallel016ExtremeScale>
        <Function test_tiny_scale>
        <Function test_large_cell>
        <Function test_long_distance>
        <Function test_extreme_scale_c_comparison>
        <Function test_combined_extremes>
        <Function test_numerical_stability_metrics>
    <Module test_at_parallel_017.py>
      <Class TestATParallel017GrazingIncidence>
        <Function test_large_detector_tilts>
        <Function test_large_twotheta>
        <Function test_combined_extreme_angles>
        <Function test_near_90_degree_incidence>
        <Function test_solid_angle_obliquity_corrections>
        <Function test_extreme_rotation_stability>
    <Module test_at_parallel_018.py>
      <Class TestATParallel018CrystalBoundaryConditions>
        <Function test_cubic_crystal_aligned_axes>
        <Function test_zero_angle_rotations>
        <Function test_near_singular_cell_angles>
        <Function test_aligned_spindle_and_beam>
        <Function test_very_small_unit_cell>
        <Function test_very_large_unit_cell>
        <Function test_continuity_near_90_degrees>
        <Function test_identity_misset_matrix>
    <Module test_at_parallel_020.py>
      <Class TestATParallel020>
        <Function test_comprehensive_integration>
        <Function test_comprehensive_without_absorption>
        <Function test_phi_rotation_only>
        <Function test_comprehensive_minimal_features>
    <Module test_at_parallel_021.py>
      <Class TestCrystalPhiRotation>
        <Function test_single_step_phi_rotation>
        <Function test_multi_step_phi_rotation>
    <Module test_at_parallel_022.py>
      <Class TestATParallel022>
        <Function test_single_step_with_detector_rotations>
        <Function test_multi_step_with_detector_rotations>
        <Function test_large_detector_rotations>
    <Module test_at_parallel_023.py>
      <Class TestAT_PARALLEL_023_MissetAnglesEquivalence>
        <Function test_explicit_misset_equivalence[misset_angles0-cubic-cell_params0]>
        <Function test_explicit_misset_equivalence[misset_angles0-triclinic-cell_params1]>
        <Function test_explicit_misset_equivalence[misset_angles1-cubic-cell_params0]>
        <Function test_explicit_misset_equivalence[misset_angles1-triclinic-cell_params1]>
        <Function test_explicit_misset_equivalence[misset_angles2-cubic-cell_params0]>
        <Function test_explicit_misset_equivalence[misset_angles2-triclinic-cell_params1]>
        <Function test_explicit_misset_equivalence[misset_angles3-cubic-cell_params0]>
        <Function test_explicit_misset_equivalence[misset_angles3-triclinic-cell_params1]>
        <Function test_explicit_misset_equivalence[misset_angles4-cubic-cell_params0]>
        <Function test_explicit_misset_equivalence[misset_angles4-triclinic-cell_params1]>
        <Function test_misset_changes_pattern>
    <Module test_at_parallel_024.py>
      <Class TestAT_PARALLEL_024>
        <Function test_pytorch_determinism>
        <Function test_seed_independence>
        <Function test_c_pytorch_equivalence>
        <Function test_lcg_compatibility>
        <Function test_mosaic_rotation_umat_determinism>
        <Function test_umat2misset_round_trip>
    <Module test_at_parallel_025.py>
      <Function test_maximum_intensity_simple_case>
      <Function test_maximum_intensity_with_offset>
      <Function test_maximum_intensity_triclinic>
    <Module test_at_parallel_026.py>
      <Class TestAT_PARALLEL_026_TriclinicAbsolutePosition>
        <Function test_triclinic_absolute_peak_position_pytorch_only>
        <Function test_triclinic_absolute_peak_position_vs_c>
        <Function test_triclinic_vs_cubic_peak_difference>
    <Module test_at_parallel_027.py>
      <Class TestAT_PARALLEL_027>
        <Function test_structure_factor_loading>
        <Function test_intensity_ratios>
        <Function test_pattern_structure>
        <Function test_c_pytorch_equivalence>
        <Function test_f_squared_scaling>
    <Module test_at_parallel_028.py>
      <Class TestATParallel028PerformanceParity>
        <Function test_cpu_performance_parity>
        <Function test_gpu_performance_superiority>
        <Function test_performance_measurement_validity>
    <Module test_at_parallel_029.py>
      <Class TestSubpixelSamplingAT029>
        <Function test_pytorch_aliasing_reduction>
        <Function test_pytorch_peak_stability>
        <Function test_pytorch_fwhm_convergence>
        <Function test_c_pytorch_oversample_equivalence>
        <Function test_issue_subpixel_aliasing>
    <Module test_at_perf_001.py>
      <Class TestATPERF001VectorizationPerformance>
        <Function test_vectorization_scaling>
        <Function test_performance_parity_with_c>
        <Function test_memory_scaling>
    <Module test_at_perf_002.py>
      <Class TestATPERF002ParallelExecution>
        <Function test_cpu_thread_scaling>
        <Function test_pytorch_cpu_vs_c_performance>
        <Function test_gpu_acceleration>
        <Function test_thread_efficiency>
    <Module test_at_perf_003.py>
      <Class TestATPERF003MemoryBandwidth>
        <Function test_peak_memory_usage>
        <Function test_float32_vs_float64_performance>
        <Function test_cache_friendly_access>
        <Function test_memory_bandwidth_utilization>
        <Function test_intermediate_tensor_optimization>
    <Module test_at_perf_004.py>
      <Class TestATPERF004HotPathOptimization>
        <Function test_sincg_throughput>
        <Function test_dot_product_throughput>
        <Function test_profile_hot_paths>
        <Function test_vectorization_efficiency>
        <Function test_critical_operations_performance>
    <Module test_at_perf_005.py>
      <Class TestATPERF005CompilationOptimization>
        <Function test_torch_compile_speedup>
        <Function test_hot_function_compilation>
        <Function test_compilation_amortization>
        <Function test_gpu_kernel_compilation>
        <Function test_dtype_optimization_impact>
    <Module test_at_perf_006.py>
      <Class TestATPERF006TensorVectorization>
        <Function test_no_python_loops_in_core_path>
        <Function test_profile_tensor_operations_ratio>
        <Function test_vectorized_speedup>
        <Function test_tensor_shapes_include_all_dimensions>
      <Function test_oversample_performance_scaling[1]>
      <Function test_oversample_performance_scaling[2]>
      <Function test_oversample_performance_scaling[3]>
      <Function test_oversample_performance_scaling[4]>
      <Function test_detector_thickness_vectorization>
    <Module test_at_perf_007.py>
      <Class TestATPerf007ComprehensiveBenchmark>
        <Function test_benchmark_suite_execution>
        <Function test_pytorch_performance_basic>
        <Function test_memory_scaling>
        <Function test_gpu_performance>
        <Function test_benchmark_output_format>
    <Module test_at_perf_008.py>
      <Class TestATPERF008CUDATensorResidency>
        <Function test_large_tensor_gpu_residency>
        <Function test_auto_device_selection_uses_cuda>
        <Function test_skip_when_cuda_unavailable>
        <Function test_memory_efficient_gpu_usage>
    <Module test_at_pol_001.py>
      <Class TestATPOL001KahnModel>
        <Function test_polarization_factor_calculation>
        <Function test_nopolar_toggle>
        <Function test_oversample_polar_last_value_semantics>
        <Function test_polarization_with_tilted_detector>
        <Function test_polarization_factor_range>
    <Module test_at_pre_001.py>
      <Function test_header_precedence_img_then_mask>
      <Function test_mask_beam_center_y_flip>
      <Function test_img_only_no_mask>
    <Module test_at_pre_002.py>
      <Function test_xbeam_ybeam_forces_beam_pivot>
      <Function test_xclose_yclose_forces_sample_pivot>
      <Function test_orgx_orgy_forces_sample_pivot>
      <Function test_explicit_pivot_override>
      <Function test_distance_vs_close_distance_pivot_defaults>
      <Function test_convention_default_pivots>
    <Module test_at_roi_001.py>
      <Class TestAT_ROI_001>
        <Function test_roi_bounds_default_to_full_detector>
        <Function test_roi_bounds_validation>
        <Function test_roi_limits_rendering_area>
        <Function test_mask_array_filtering>
        <Function test_roi_and_mask_combination>
        <Function test_mask_array_dimension_validation>
        <Function test_statistics_exclude_masked_pixels>
    <Module test_at_sam_001.py>
      <Function test_at_sam_001_steps_normalization>
    <Module test_at_sam_002.py>
      <Class TestAT_SAM_002_OversampleLastValue>
        <Function test_oversample_omega_last_value_semantics>
        <Function test_oversample_without_subpixel_flags>
        <Function test_oversample_flag_precedence>
    <Module test_at_sam_003.py>
      <Function test_dmin_culling_basic>
      <Function test_dmin_culling_exact_threshold>
      <Function test_dmin_zero_no_culling>
    <Module test_at_src_001.py>
      <Class TestAT_SRC_001_SourcefileAndWeighting>
        <Function test_sourcefile_with_all_columns>
        <Function test_sourcefile_with_missing_columns>
        <Function test_sourcefile_default_position>
        <Function test_multiple_sources_normalization>
        <Function test_empty_sourcefile>
        <Function test_weighted_sources_integration>
    <Module test_at_src_001_cli.py>
      <Class TestAT_SRC_001_CLI>
        <Function test_sourcefile_loading_via_cli>
        <Function test_sourcefile_with_missing_columns>
        <Function test_sourcefile_takes_precedence_over_divergence>
    <Module test_at_src_001_simple.py>
      <Function test_sourcefile_parsing>
    <Module test_at_src_002.py>
      <Class TestAT_SRC_002>
        <Function test_no_parameters_provided>
        <Function test_only_step_provided>
        <Function test_only_range_provided>
        <Function test_only_count_provided_angles>
        <Function test_only_count_provided_thickness>
        <Function test_range_and_step_provided>
        <Function test_count_and_range_provided>
        <Function test_divergence_auto_selection>
        <Function test_dispersion_auto_selection>
        <Function test_thickness_auto_selection>
        <Function test_all_parameters_provided>
        <Function test_conflicting_parameters>
    <Module test_at_sta_001.py>
      <Class TestAT_STA_001>
        <Function test_statistics_basic>
        <Function test_statistics_with_roi>
        <Function test_statistics_with_mask>
        <Function test_statistics_empty_roi>
        <Function test_statistics_last_max_location>
    <Module test_at_str_001.py>
      <Function test_at_str_001_nearest_neighbor_lookup>
    <Module test_at_str_002.py>
      <Function test_tricubic_interpolation_enabled>
      <Function test_tricubic_out_of_bounds_fallback>
      <Function test_auto_enable_interpolation>
    <Module test_at_str_003.py>
      <Class TestAT_STR_003_LatticeShapeModels>
        <Function test_square_shape_model>
        <Function test_round_shape_model>
        <Function test_gauss_shape_model>
        <Function test_tophat_shape_model>
        <Function test_shape_model_comparison>
        <Function test_fudge_parameter_scaling>
        <Function test_shape_models_at_bragg_peak>
    <Module test_at_str_004.py>
      <Class TestAT_STR_004>
        <Function test_sparse_hkl_loading>
        <Function test_missing_reflection_uses_default_f>
        <Function test_intensity_ratios_with_sparse_hkl>
        <Function test_fallback_with_no_hkl_uses_default_f>
        <Function test_fdump_preserves_sparse_behavior>
    <Module test_at_tools_001.py>
      <Class TestAT_TOOLS_001_DualRunnerComparison>
        <Function test_find_c_binary_resolution>
        <Function test_find_py_binary_resolution>
        <Function test_load_float_image>
        <Function test_resample_image>
        <Function test_compute_metrics>
        <Function test_find_peaks>
        <Function test_script_integration>
        <Function test_metrics_with_identical_images>
        <Function test_metrics_with_scaled_images>
    <Module test_cli_flags.py>
      <Class TestPix0VectorAlias>
        <Function test_pix0_meters_alias>
        <Function test_pix0_millimeter_alias>
        <Function test_pix0_meters_and_mm_equivalence>
        <Function test_dual_pix0_flag_rejection>
        <Function test_pix0_signed_combinations[pix0_m0-pix0_mm0]>
        <Function test_pix0_signed_combinations[pix0_m1-pix0_mm1]>
        <Function test_pix0_signed_combinations[pix0_m2-pix0_mm2]>
      <Class TestDetectorOverridePersistence>
        <Function test_detector_override_persistence_cpu>
        <Function test_detector_override_persistence_cuda>
        <Function test_detector_override_dtype_preservation>
      <Class TestNoiseSuppressionFlag>
        <Function test_nonoise_suppresses_noise_output>
        <Function test_noisefile_without_nonoise>
        <Function test_nonoise_preserves_seed>
        <Function test_nonoise_without_noisefile>
      <Class TestCLIIntegrationSanity>
        <Function test_pix0_does_not_alter_beam_vector>
        <Function test_pix0_triggers_custom_convention>
        <Function test_roi_unaffected_by_new_flags>
        <Function test_convention_preserved_without_pix0>
    <Module test_configuration_consistency.py>
      <Class TestConfigurationConsistency>
        <Function test_explicit_defaults_equal_implicit>
        <Function test_configuration_echo_present>
        <Function test_mode_detection_accuracy>
        <Function test_trigger_tracking>
        <Function test_all_vector_parameters_trigger_custom>
    <Module test_crystal_geometry.py>
      <Class TestCrystalGeometry>
        <Function test_cubic_regression>
        <Function test_triclinic_correctness>
        <Function test_metric_duality>
        <Function test_volume_identity>
        <Function test_resolution_shell_consistency>
        <Function test_rotation_invariance>
        <Function test_gradient_flow>
        <Function test_angles_to_rotation_matrix_identity>
        <Function test_angles_to_rotation_matrix_x_rotation>
        <Function test_angles_to_rotation_matrix_y_rotation>
        <Function test_angles_to_rotation_matrix_z_rotation>
        <Function test_angles_to_rotation_matrix_order>
        <Function test_angles_to_rotation_matrix_properties>
        <Function test_angles_to_rotation_matrix_tensor_types>
        <Function test_misset_orientation>
        <Function test_misset_zero_rotation>
        <Function test_misset_tensor_inputs>
        <Function test_misset_rotation_order>
        <Function test_misset_gradient_flow>
    <Module test_custom_vectors.py>
      <Class TestCustomVectors>
        <Function test_custom_vectors_in_detector_config>
        <Function test_custom_vectors_in_detector>
        <Function test_cli_custom_vectors>
        <Function test_custom_convention_detection>
        <Function test_custom_spindle_axis>
    <Module test_debug_trace.py>
      <Class TestDebugTraceFeatures>
        <Function test_printout_flag>
        <Function test_printout_pixel_flag>
        <Function test_trace_pixel_flag>
        <Function test_combined_debug_flags>
        <Function test_out_of_bounds_pixel>
    <Module test_detector_basis_vectors.py>
      <Class TestDetectorBasisVectors>
        <Function test_default_mosflm_convention>
        <Function test_default_xds_convention>
        <Function test_single_axis_rotations>
        <Function test_combined_rotations>
        <Function test_twotheta_rotation>
        <Function test_all_rotations_combined>
        <Function test_tensor_rotation_parameters>
    <Module test_detector_config.py>
      <Class TestDetectorConfig>
        <Function test_default_values>
        <Function test_post_init_defaults>
        <Function test_custom_twotheta_axis>
        <Function test_xds_convention_defaults>
        <Function test_invalid_pixel_counts>
        <Function test_invalid_distance>
        <Function test_invalid_pixel_size>
        <Function test_invalid_oversample>
        <Function test_tensor_parameters>
      <Class TestDetectorInitialization>
        <Function test_default_initialization>
        <Function test_custom_config_initialization>
        <Function test_backward_compatibility_check>
        <Function test_custom_config_not_default>
        <Function test_basis_vectors_initialization>
        <Function test_device_and_dtype>
    <Module test_detector_conventions.py>
      <Class TestDetectorConventions>
        <Function test_adxv_convention_basis_vectors>
        <Function test_denzo_convention_basis_vectors>
        <Function test_denzo_beam_center_mapping>
        <Function test_adxv_beam_direction>
        <Function test_adxv_twotheta_axis_default>
        <Function test_denzo_twotheta_axis_default>
        <Function test_adxv_default_beam_centers>
        <Function test_all_conventions_orthonormal>
        <Function test_conventions_with_rotations>
    <Module test_detector_geometry.py>
      <Class TestDetectorGeometryRegressions>
        <Function test_rotated_basis_vectors_match_c_reference>
        <Function test_pix0_vector_matches_c_reference_in_beam_pivot>
        <Function test_mosflm_axis_mapping_correctness>
      <Class TestDetectorDifferentiability>
        <Function test_detector_parameter_gradients>
        <Function test_basis_vector_gradients>
        <Function test_pixel_coords_basis_vector_gradients>
        <Function test_comprehensive_gradcheck>
        <Function test_beam_strike_invariant_in_beam_pivot_mode>
        <Function test_xds_convention_basic_geometry>
        <Function test_detector_real_valued_gradients>
        <Function test_detector_complex_gradient_edge_cases>
        <Function test_simulator_real_valued_gradients>
    <Module test_detector_pivots.py>
      <Function test_beam_pivot_keeps_beam_indices_and_alignment>
      <Function test_sample_pivot_moves_beam_indices_with_twotheta>
    <Module test_divergence_culling.py>
      <Class TestDivergenceCullingModes>
        <Function test_round_div_applies_elliptical_trimming>
        <Function test_square_div_uses_full_grid>
        <Function test_round_vs_square_source_count_difference>
        <Function test_single_divergence_point_unaffected>
        <Function test_elliptical_trimming_threshold>
        <Function test_combined_divergence_and_dispersion>
    <Module test_gradients.py>
      <Class TestCellParameterGradients>
        <Function test_gradcheck_cell_a>
        <Function test_gradcheck_cell_b>
        <Function test_gradcheck_cell_c>
        <Function test_gradcheck_cell_alpha>
        <Function test_gradcheck_cell_beta>
        <Function test_gradcheck_cell_gamma>
      <Class TestAdvancedGradients>
        <Function test_joint_gradcheck>
        <Function test_gradgradcheck_cell_params>
        <Function test_gradient_flow_simulation>
      <Class TestPropertyBasedGradients>
        <Function test_property_metric_duality>
        <Function test_property_volume_consistency>
        <Function test_property_gradient_stability>
      <Class TestOptimizationRecovery>
        <Function test_optimization_recovers_cell>
        <Function test_multiple_optimization_scenarios>
    <Module test_mosflm_matrix.py>
      <Class TestMOSFLMMatrixLoading>
        <Function test_read_identity_matrix>
        <Function test_read_cubic_matrix>
        <Function test_wavelength_scaling>
        <Function test_triclinic_matrix>
        <Function test_missing_file>
        <Function test_invalid_format>
        <Function test_comments_and_whitespace>
    <Module test_multi_source_integration.py>
      <Function test_multi_source_intensity_normalization>
    <Module test_oversample_autoselect.py>
      <Class TestOversampleAutoSelect>
        <Function test_auto_select_formula>
        <Function test_different_crystal_sizes>
        <Function test_explicit_oversample_overrides_auto>
        <Function test_different_wavelengths>
    <Module test_parity_coverage_lint.py>
      <Class TestParityCoverageLinter>
        <Function test_linter_finds_repo_root>
        <Function test_linter_loads_yaml>
        <Function test_yaml_structure_validation>
        <Function test_missing_yaml_file>
        <Function test_invalid_yaml>
        <Function test_real_repo_linting>
        <Function test_extraction_of_spec_ats>
        <Function test_extraction_of_yaml_ats>
    <Module test_parity_matrix.py>
      <Function test_parity_case[AT-PARALLEL-001-detpixels-64]>
      <Function test_parity_case[AT-PARALLEL-001-detpixels-128]>
      <Function test_parity_case[AT-PARALLEL-001-detpixels-256]>
      <Function test_parity_case[AT-PARALLEL-001-detpixels-512]>
      <Function test_parity_case[AT-PARALLEL-002-pixel-0.05mm]>
      <Function test_parity_case[AT-PARALLEL-002-pixel-0.1mm]>
      <Function test_parity_case[AT-PARALLEL-002-pixel-0.2mm]>
      <Function test_parity_case[AT-PARALLEL-002-pixel-0.4mm]>
      <Function test_parity_case[AT-PARALLEL-003-beam-20-20-detpixels-256]>
      <Function test_parity_case[AT-PARALLEL-003-beam-30-40-detpixels-256]>
      <Function test_parity_case[AT-PARALLEL-003-beam-45-25-detpixels-512]>
      <Function test_parity_case[AT-PARALLEL-003-beam-60-60-detpixels-1024]>
      <Function test_parity_case[AT-PARALLEL-004-mosflm]>
      <Function test_parity_case[AT-PARALLEL-004-xds]>
      <Function test_parity_case[AT-PARALLEL-005-mosflm-xbeam-ybeam-beam-pivot]>
      <Function test_parity_case[AT-PARALLEL-005-xds-xbeam-ybeam-sample-pivot]>
      <Function test_parity_case[AT-PARALLEL-005-mosflm-close-distance-sample-pivot]>
      <Function test_parity_case[AT-PARALLEL-005-xds-close-distance-sample-pivot]>
      <Function test_parity_case[AT-PARALLEL-006-dist-50mm-lambda-1.0]>
      <Function test_parity_case[AT-PARALLEL-006-dist-100mm-lambda-1.5]>
      <Function test_parity_case[AT-PARALLEL-006-dist-200mm-lambda-2.0]>
      <Function test_parity_case[AT-PARALLEL-007-rot-0-0-0]>
      <Function test_parity_case[AT-PARALLEL-007-rot-5-3-2]>
      <Function test_parity_case[AT-PARALLEL-007-rot-10-5-3]>
      <Function test_parity_case[AT-PARALLEL-012-simple_cubic]>
      <Function test_parity_case[AT-PARALLEL-011-unpolarized]>
      <Function test_parity_case[AT-PARALLEL-011-polarized]>
      <Function test_parity_case[AT-PARALLEL-020-comprehensive]>
      <Function test_parity_case[AT-PARALLEL-021-single_step_phi]>
      <Function test_parity_case[AT-PARALLEL-021-multi_step_phi]>
      <Function test_parity_case[AT-PARALLEL-022-single_step_phi]>
      <Function test_parity_case[AT-PARALLEL-022-multi_step_phi]>
      <Function test_parity_case[AT-PARALLEL-023-cubic-misset-0-0-0]>
      <Function test_parity_case[AT-PARALLEL-023-cubic-misset-10p5-0-0]>
      <Function test_parity_case[AT-PARALLEL-023-cubic-misset-0-10p25-0]>
      <Function test_parity_case[AT-PARALLEL-023-cubic-misset-0-0-9p75]>
      <Function test_parity_case[AT-PARALLEL-023-cubic-misset-15-20p5-30p25]>
      <Function test_parity_case[AT-PARALLEL-023-triclinic-misset-0-0-0]>
      <Function test_parity_case[AT-PARALLEL-023-triclinic-misset-10p5-0-0]>
      <Function test_parity_case[AT-PARALLEL-023-triclinic-misset-0-10p25-0]>
      <Function test_parity_case[AT-PARALLEL-023-triclinic-misset-0-0-9p75]>
      <Function test_parity_case[AT-PARALLEL-023-triclinic-misset-15-20p5-30p25]>
      <Function test_parity_case[AT-PARALLEL-024-random-misset-seed-12345]>
      <Function test_parity_case[AT-PARALLEL-024-random-misset-seed-54321]>
      <Function test_parity_case[AT-PARALLEL-010-point-pixel-distance-50mm]>
      <Function test_parity_case[AT-PARALLEL-010-point-pixel-distance-100mm]>
      <Function test_parity_case[AT-PARALLEL-010-point-pixel-distance-200mm]>
      <Function test_parity_case[AT-PARALLEL-010-point-pixel-distance-400mm]>
      <Function test_parity_case[AT-PARALLEL-010-obliquity-distance-100mm-tilt-0deg]>
      <Function test_parity_case[AT-PARALLEL-010-obliquity-distance-100mm-tilt-10deg]>
      <Function test_parity_case[AT-PARALLEL-010-obliquity-distance-100mm-tilt-20deg]>
      <Function test_parity_case[AT-PARALLEL-010-obliquity-distance-100mm-tilt-30deg]>
      <Function test_parity_case[AT-PARALLEL-016-extreme-tiny]>
      <Function test_parity_case[AT-PARALLEL-016-extreme-large-cell]>
      <Function test_parity_case[AT-PARALLEL-016-extreme-long-distance]>
    <Module test_perf_pytorch_005_cudagraphs.py>
      <Class TestCUDAGraphsCompatibility>
        <Function test_basic_execution[cpu]>
        <Function test_basic_execution[cuda]>
        <Function test_cuda_multiple_runs>
        <Function test_gradient_flow_preserved>
        <Function test_cpu_cuda_correlation[cpu]>
        <Function test_cpu_cuda_correlation[cuda]>
    <Module test_perf_pytorch_006.py>
      <Function test_dtype_support[dtype0]>
      <Function test_dtype_support[dtype1]>
      <Function test_float32_float64_correlation>
    <Module test_physics.py>
      <Class TestPhysicsFunctions>
        <Function test_sincg_against_c_value>
        <Function test_sincg_fractional_miller_index>
        <Function test_sincg_at_zero>
        <Function test_sincg_vectorized>
        <Function test_sincg_broadcast_N>
    <Module test_pivot_mode_selection.py>
      <Class TestPivotModeSelection>
        <Function test_twotheta_zero_uses_config_pivot>
        <Function test_twotheta_nonzero_forces_sample_pivot>
        <Function test_small_twotheta_values>
        <Function test_negative_twotheta_forces_sample_pivot>
        <Function test_pivot_fix_integration>
    <Module test_show_config.py>
      <Class TestShowConfig>
        <Function test_show_config_basic>
        <Function test_show_config_with_divergence>
        <Function test_show_config_with_rotations>
        <Function test_echo_config_alias>
    <Module test_suite.py>
      <Class TestGeometryFunctions>
        <Function test_dot_product>
        <Function test_cross_product>
        <Function test_magnitude>
        <Function test_unitize>
        <Function test_rotate_axis>
        <Function test_rotate_umat>
      <Class TestCrystalModel>
        <Function test_zero_rotation>
        <Function test_phi_rotation_90_deg>
        <Function test_rotation_gradients>
      <Class TestTier1TranslationCorrectness>
        <Function test_golden_data_exists>
        <Function test_simple_cubic_reproduction>
        <Function test_cubic_tilted_detector_reproduction>
        <Function test_triclinic_P1_reproduction>
        <Function test_peak_position_validation>
        <Function test_sensitivity_to_cell_params>
        <Function test_performance_simple_cubic>
        <Function test_performance_triclinic>
        <Function test_memory_usage_analysis>
        <Function test_extreme_cell_parameters>
        <Function test_rotation_compatibility>
        <Function test_simple_cubic_mosaic_reproduction>
        <Function test_simulator_phi_rotation>
      <Class TestTier2GradientCorrectness>
        <Function test_gradcheck_crystal_params>
        <Function test_gradcheck_detector_params>
        <Function test_gradcheck_phi_rotation>
        <Function test_gradcheck_mosaic_spread>
        <Function test_gradient_numerical_stability>
      <Class TestTier3ScientificValidation>
        <Function test_bragg_spot_position>
        <Function test_polarization_limits>
      <Function test_import>
    <Module test_units.py>
      <Class TestUnitConversions>
        <Function test_mm_to_angstroms_scalar>
        <Function test_mm_to_angstroms_tensor>
        <Function test_mm_to_angstroms_gradient>
        <Function test_meters_to_angstroms_scalar>
        <Function test_meters_to_angstroms_tensor>
        <Function test_degrees_to_radians_scalar>
        <Function test_degrees_to_radians_tensor>
        <Function test_degrees_to_radians_gradient>
        <Function test_inverse_conversions>
        <Function test_batch_tensor_conversions>

=============================== warnings summary ===============================
tests/test_at_parallel_026.py:23
  /home/ollie/Documents/tmp/nanoBragg/tests/test_at_parallel_026.py:23: PytestUnknownMarkWarning: Unknown pytest.mark.parallel_validation - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytest.mark.parallel_validation

tests/test_at_parallel_026.py:116
  /home/ollie/Documents/tmp/nanoBragg/tests/test_at_parallel_026.py:116: PytestUnknownMarkWarning: Unknown pytest.mark.requires_c_binary - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.requires_c_binary

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
========================= 624 tests collected in 2.71s =========================
