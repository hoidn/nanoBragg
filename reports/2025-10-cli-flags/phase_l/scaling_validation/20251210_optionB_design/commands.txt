# Option B Batch Cache Prototype — Execution Commands

## Environment Setup
export KMP_DUPLICATE_LIB_OK=TRUE

## Test Collection Validation (M2g.2c prerequisite)
pytest --collect-only tests/test_cli_scaling_parity.py -q
# Expected: 1 test collected

## Prototype Execution
cd reports/2025-10-cli-flags/phase_l/scaling_validation/20251210_optionB_design
KMP_DUPLICATE_LIB_OK=TRUE python prototype_batch_cache.py 2>&1 | tee prototype_run.log
# Expected exit code: 0 (success)

## Artifact Generation
# metrics.json — Auto-generated by prototype script
# env.json — Captured via Python script
# sha256.txt — Checksums of all artifacts

## Expected Outputs
# ✅ Gradcheck PASS
# ✅ Cache indexing correct (4×4×3 shape)
# ✅ Gradient magnitude ~31.6 (finite, non-zero)
# ✅ Memory footprint 0.2 KB (negligible)

## Next Actions (after prototype validates)
# M2g.3: Allocate pixel-indexed caches in Crystal
# M2g.4: Wire get_rotated_real_vectors_for_batch() into Simulator
# M2g.5: Update trace harness + parity scripts
# M2g.6: Document architecture decision in phi_carryover_diagnosis.md
